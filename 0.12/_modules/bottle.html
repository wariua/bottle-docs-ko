
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>bottle &#8212; Bottle 0.12.18 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for bottle</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bottle is a fast and simple micro-framework for small web applications. It</span>
<span class="sd">offers request dispatching (Routes) with url parameter support, templates,</span>
<span class="sd">a built-in HTTP Server and adapters for many third party WSGI/HTTP-server and</span>
<span class="sd">template engines - all in a single file and with no dependencies other than the</span>
<span class="sd">Python Standard Library.</span>

<span class="sd">Homepage and documentation: http://bottlepy.org/</span>

<span class="sd">Copyright (c) 2016, Marcel Hellkamp.</span>
<span class="sd">License: MIT (see LICENSE for details)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Marcel Hellkamp&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.12.18&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;MIT&#39;</span>

<span class="c1"># The gevent server adapter needs to patch some modules before they are imported</span>
<span class="c1"># This is why we parse the commandline parameters here but handle them later</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
    <span class="n">_cmd_parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s2">&quot;usage: %prog [options] package.module:app&quot;</span><span class="p">)</span>
    <span class="n">_opt</span> <span class="o">=</span> <span class="n">_cmd_parser</span><span class="o">.</span><span class="n">add_option</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show version number.&quot;</span><span class="p">)</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;--bind&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ADDRESS&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;bind socket to ADDRESS.&quot;</span><span class="p">)</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--server&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;wsgiref&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use SERVER as backend.&quot;</span><span class="p">)</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--plugin&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;install additional plugin/s.&quot;</span><span class="p">)</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;start server in debug mode.&quot;</span><span class="p">)</span>
    <span class="n">_opt</span><span class="p">(</span><span class="s2">&quot;--reload&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;auto-reload on file changes.&quot;</span><span class="p">)</span>
    <span class="n">_cmd_options</span><span class="p">,</span> <span class="n">_cmd_args</span> <span class="o">=</span> <span class="n">_cmd_parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">_cmd_options</span><span class="o">.</span><span class="n">server</span> <span class="ow">and</span> <span class="n">_cmd_options</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gevent&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">gevent.monkey</span><span class="p">;</span> <span class="n">gevent</span><span class="o">.</span><span class="n">monkey</span><span class="o">.</span><span class="n">patch_all</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">email.utils</span><span class="o">,</span> <span class="nn">functools</span><span class="o">,</span> <span class="nn">hmac</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">mimetypes</span><span class="o">,</span>\
        <span class="n">os</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">tempfile</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">hashlib</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span> <span class="k">as</span> <span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryFile</span>
<span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">format_exc</span><span class="p">,</span> <span class="n">print_exc</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getargspec</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">normalize</span>


<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">simplejson</span> <span class="kn">import</span> <span class="n">dumps</span> <span class="k">as</span> <span class="n">json_dumps</span><span class="p">,</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_lds</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="c1"># pragma: no cover</span>
    <span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span> <span class="k">as</span> <span class="n">json_dumps</span><span class="p">,</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_lds</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">django.utils.simplejson</span> <span class="kn">import</span> <span class="n">dumps</span> <span class="k">as</span> <span class="n">json_dumps</span><span class="p">,</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_lds</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">json_dumps</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;JSON support requires Python 2.6 or simplejson.&quot;</span><span class="p">)</span>
            <span class="n">json_lds</span> <span class="o">=</span> <span class="n">json_dumps</span>



<span class="c1"># We now try to fix 2.5/2.6/3.1/3.2 incompatibilities.</span>
<span class="c1"># It ain&#39;t pretty but it works... Sorry for the mess.</span>

<span class="n">py</span>   <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span>
<span class="n">py3k</span> <span class="o">=</span> <span class="n">py</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">py25</span> <span class="o">=</span> <span class="n">py</span> <span class="o">&lt;</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">py31</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">py</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Workaround for the missing &quot;as&quot; keyword in py3k.</span>
<span class="k">def</span> <span class="nf">_e</span><span class="p">():</span> <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Workaround for the &quot;print is a keyword/function&quot; Python 2/3 dilemma</span>
<span class="c1"># and a fallback for mod_wsgi (resticts stdout/err attribute access)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_stdout</span><span class="p">,</span> <span class="n">_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="n">_stdout</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">_stderr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Lots of stdlib and builtin differences.</span>
<span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">http.client</span> <span class="k">as</span> <span class="nn">httplib</span>
    <span class="kn">import</span> <span class="nn">_thread</span> <span class="k">as</span> <span class="nn">thread</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">SplitResult</span> <span class="k">as</span> <span class="n">UrlSplitResult</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span> <span class="k">as</span> <span class="n">urlquote</span><span class="p">,</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">urlunquote</span>
    <span class="n">urlunquote</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">urlunquote</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">http.cookies</span> <span class="kn">import</span> <span class="n">SimpleCookie</span>
    <span class="k">if</span> <span class="n">py</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span> <span class="k">as</span> <span class="n">DictMixin</span>
        <span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">ModuleType</span> <span class="k">as</span> <span class="n">new_module</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableMapping</span> <span class="k">as</span> <span class="n">DictMixin</span>
        <span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="n">new_module</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
    <span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">json_loads</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">json_lds</span><span class="p">(</span><span class="n">touni</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span>
    <span class="n">imap</span> <span class="o">=</span> <span class="nb">map</span>
    <span class="k">def</span> <span class="nf">_raise</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">):</span> <span class="k">raise</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span> <span class="c1"># 2.x</span>
    <span class="kn">import</span> <span class="nn">httplib</span>
    <span class="kn">import</span> <span class="nn">thread</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">SplitResult</span> <span class="k">as</span> <span class="n">UrlSplitResult</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span> <span class="k">as</span> <span class="n">urlquote</span><span class="p">,</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">urlunquote</span>
    <span class="kn">from</span> <span class="nn">Cookie</span> <span class="kn">import</span> <span class="n">SimpleCookie</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">imap</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
    <span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="n">new_module</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span> <span class="k">as</span> <span class="n">BytesIO</span>
    <span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="kn">import</span> <span class="n">SafeConfigParser</span> <span class="k">as</span> <span class="n">ConfigParser</span>
    <span class="k">if</span> <span class="n">py25</span><span class="p">:</span>
        <span class="n">msg</span>  <span class="o">=</span> <span class="s2">&quot;Python 2.5 support may be dropped in future versions of Bottle.&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">UserDict</span> <span class="kn">import</span> <span class="n">DictMixin</span>
        <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="n">it</span><span class="p">):</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># 2.6, 2.7</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableMapping</span> <span class="k">as</span> <span class="n">DictMixin</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span>
    <span class="n">json_loads</span> <span class="o">=</span> <span class="n">json_lds</span>
    <span class="nb">eval</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="s1">&#39;def _raise(*a): raise a[0], a[1], a[2]&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;py3fix&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">))</span>

<span class="c1"># Some helpers for string/byte handling</span>
<span class="k">def</span> <span class="nf">tob</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">enc</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">touni</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">enc</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">unicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">tonat</span> <span class="o">=</span> <span class="n">touni</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="n">tob</span>

<span class="c1"># 3.2 fixes cgi.FieldStorage to accept bytes (which makes a lot of sense).</span>
<span class="c1"># 3.1 needs a workaround.</span>
<span class="k">if</span> <span class="n">py31</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">TextIOWrapper</span>
    <span class="k">class</span> <span class="nc">NCTextIOWrapper</span><span class="p">(</span><span class="n">TextIOWrapper</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span> <span class="c1"># Keep wrapped buffer open.</span>


<span class="c1"># A bug in functools causes it to break if the wrapper is an instance method</span>
<span class="k">def</span> <span class="nf">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>



<span class="c1"># These helpers are used at module level and need to be defined first.</span>
<span class="c1"># And yes, I know PEP-8, but sometimes a lower-case classname makes more sense.</span>

<span class="k">def</span> <span class="nf">depr</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">hard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">makelist</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="c1"># This is just to handy</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>


<span class="k">class</span> <span class="nc">DictProperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Property that maps to a key in a local dict-like attribute. &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="n">attr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">read_only</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">updated</span><span class="o">=</span><span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">storage</span><span class="p">:</span> <span class="n">storage</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">storage</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Read-Only property.&quot;</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Read-Only property.&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">cached_property</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A property that is only computed once per instance and then replaces</span>
<span class="sd">        itself with an ordinary attribute. Deleting the attribute resets the</span>
<span class="sd">        property. &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">lazy_attribute</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A property that caches itself to the class object. &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">updated</span><span class="o">=</span><span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getter</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>






<span class="c1">###############################################################################</span>
<span class="c1"># Exceptions and Events ########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="BottleException"><a class="viewcode-back" href="../api.html#bottle.BottleException">[docs]</a><span class="k">class</span> <span class="nc">BottleException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 보틀에서 쓰는 예외들의 베이스 클래스. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>






<span class="c1">###############################################################################</span>
<span class="c1"># Routing ######################################################################</span>
<span class="c1">###############################################################################</span>


<span class="k">class</span> <span class="nc">RouteError</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is a base class for all routing related exceptions &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">RouteReset</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; If raised by a plugin or request handler, the route is reset and all</span>
<span class="sd">        plugins are re-applied. &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">RouterUnknownModeError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span> <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RouteSyntaxError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The route parser found something not supported by this router. &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">RouteBuildError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The route could not be built. &quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_re_flatten</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Turn all capturing groups in a regular expression pattern into</span>
<span class="sd">        non-capturing groups. &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(</span><span class="se">\\</span><span class="s1">*)(\(\?P&lt;[^&gt;]+&gt;|\((?!\?))&#39;</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;(?:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Router</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A Router is an ordered collection of route-&gt;target pairs. It is used to</span>
<span class="sd">        efficiently match WSGI requests against a number of routes and return</span>
<span class="sd">        the first target that satisfies the request. The target may be anything,</span>
<span class="sd">        usually a string, ID or callable object. A route consists of a path-rule</span>
<span class="sd">        and a HTTP method.</span>

<span class="sd">        The path-rule is either a static path (e.g. `/contact`) or a dynamic</span>
<span class="sd">        path that contains wildcards (e.g. `/wiki/&lt;page&gt;`). The wildcard syntax</span>
<span class="sd">        and details on the matching order are described in docs:`routing`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">default_pattern</span> <span class="o">=</span> <span class="s1">&#39;[^/]+&#39;</span>
    <span class="n">default_filter</span>  <span class="o">=</span> <span class="s1">&#39;re&#39;</span>

    <span class="c1">#: The current CPython regexp implementation does not allow more</span>
    <span class="c1">#: than 99 matching groups per regular expression.</span>
    <span class="n">_MAX_GROUPS_PER_PATTERN</span> <span class="o">=</span> <span class="mi">99</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># All rules in order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>  <span class="o">=</span> <span class="p">{}</span> <span class="c1"># index of regexes to find them in dyna_routes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span>  <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Data structure for the url builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static</span>   <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Search structure for static routes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span>  <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Search structure for dynamic routes</span>
        <span class="c1">#: If true, static routes are no longer checked first.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_order</span> <span class="o">=</span> <span class="n">strict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;re&#39;</span><span class="p">:</span>    <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span>
                <span class="p">(</span><span class="n">_re_flatten</span><span class="p">(</span><span class="n">conf</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pattern</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s1">&#39;int&#39;</span><span class="p">:</span>   <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-?\d+&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
            <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-?[\d.]+&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span>  <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.+?&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">add_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a filter. The provided function is called with the configuration</span>
<span class="sd">        string as parameter and must return a (regexp, to_python, to_url) tuple.</span>
<span class="sd">        The first element is a string, the last two are callables or None. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

    <span class="n">rule_syntax</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">*)&#39;</span>\
        <span class="s1">&#39;(?:(?::([a-zA-Z_][a-zA-Z_0-9]*)?()(?:#(.*?)#)?)&#39;</span>\
          <span class="s1">&#39;|(?:&lt;([a-zA-Z_][a-zA-Z_0-9]*)?(?::([a-zA-Z_]*)&#39;</span>\
            <span class="s1">&#39;(?::((?:</span><span class="se">\\\\</span><span class="s1">.|[^</span><span class="se">\\\\</span><span class="s1">&gt;]+)+)?)?)?&gt;))&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_itertokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_syntax</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="n">rule</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># Escaped wildcard</span>
                <span class="n">prefix</span> <span class="o">+=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">prefix</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">filtr</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">filtr</span> <span class="ow">or</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="ow">or</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">prefix</span><span class="o">+</span><span class="n">rule</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a new rule or replace the target for an existing rule. &#39;&#39;&#39;</span>
        <span class="n">anons</span>     <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># Number of anonymous wildcards found</span>
        <span class="n">keys</span>      <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># Names of keys</span>
        <span class="n">pattern</span>   <span class="o">=</span> <span class="s1">&#39;&#39;</span>   <span class="c1"># Regular expression pattern with named groups</span>
        <span class="n">filters</span>   <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># Lists of wildcard input filters</span>
        <span class="n">builder</span>   <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># Data structure for the URL builder</span>
        <span class="n">is_static</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itertokens</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
                <span class="n">is_static</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_filter</span>
                <span class="n">mask</span><span class="p">,</span> <span class="n">in_filter</span><span class="p">,</span> <span class="n">out_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">mode</span><span class="p">](</span><span class="n">conf</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">+=</span> <span class="s1">&#39;(?:</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">mask</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;anon</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">anons</span>
                    <span class="n">anons</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">+=</span> <span class="s1">&#39;(?P&lt;</span><span class="si">%s</span><span class="s1">&gt;</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">in_filter</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">in_filter</span><span class="p">))</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">out_filter</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">+=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="n">builder</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">builder</span>

        <span class="k">if</span> <span class="n">is_static</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">rule</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">re_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^(</span><span class="si">%s</span><span class="s1">)$&#39;</span> <span class="o">%</span> <span class="n">pattern</span><span class="p">)</span>
            <span class="n">re_match</span> <span class="o">=</span> <span class="n">re_pattern</span><span class="o">.</span><span class="n">match</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RouteSyntaxError</span><span class="p">(</span><span class="s2">&quot;Could not add Route: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">_e</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">url_args</span> <span class="o">=</span> <span class="n">re_match</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">wildcard_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">url_args</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wildcard_filter</span><span class="p">(</span><span class="n">url_args</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Path has wrong format.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">url_args</span>
        <span class="k">elif</span> <span class="n">re_pattern</span><span class="o">.</span><span class="n">groupindex</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">re_match</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getargs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">flatpat</span> <span class="o">=</span> <span class="n">_re_flatten</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">whole_rule</span> <span class="o">=</span> <span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">flatpat</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Route &lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt; overwrites a previously defined route&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">rule</span><span class="p">),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">]]</span> <span class="o">=</span> <span class="n">whole_rule</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">whole_rule</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="n">all_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="n">comborules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">maxgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_GROUPS_PER_PATTERN</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_rules</span><span class="p">),</span> <span class="n">maxgroups</span><span class="p">):</span>
            <span class="n">some</span> <span class="o">=</span> <span class="n">all_rules</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">maxgroups</span><span class="p">]</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="p">(</span><span class="n">flatpat</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">flatpat</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">some</span><span class="p">)</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;(^</span><span class="si">%s</span><span class="s1">$)&#39;</span> <span class="o">%</span> <span class="n">flatpat</span> <span class="k">for</span> <span class="n">flatpat</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">)</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[(</span><span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">some</span><span class="p">]</span>
            <span class="n">comborules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">combined</span><span class="p">,</span> <span class="n">rules</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="o">*</span><span class="n">anons</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Build an URL by filling the wildcards in a rule. &#39;&#39;&#39;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">builder</span><span class="p">:</span> <span class="k">raise</span> <span class="n">RouteBuildError</span><span class="p">(</span><span class="s2">&quot;No route with that name.&quot;</span><span class="p">,</span> <span class="n">_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">anons</span><span class="p">):</span> <span class="n">query</span><span class="p">[</span><span class="s1">&#39;anon</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="k">if</span> <span class="n">n</span> <span class="k">else</span> <span class="n">f</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">builder</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">url</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="k">else</span> <span class="n">url</span><span class="o">+</span><span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RouteBuildError</span><span class="p">(</span><span class="s1">&#39;Missing URL argument: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_e</span><span class="p">()</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a (target, url_agrs) tuple or raise HTTPError(400/404/405). &#39;&#39;&#39;</span>
        <span class="n">verb</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PROXY&#39;</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;ANY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PROXY&#39;</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="s1">&#39;ANY&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="n">path</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">getargs</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">combined</span><span class="p">,</span> <span class="n">rules</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">combined</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                        <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">lastindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">getargs</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># No matching route found. Collect alternative methods for 405 response</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">nocheck</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">)</span> <span class="o">-</span> <span class="n">nocheck</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">allowed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">)</span> <span class="o">-</span> <span class="n">allowed</span> <span class="o">-</span> <span class="n">nocheck</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">combined</span><span class="p">,</span> <span class="n">rules</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">combined</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">allowed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed</span><span class="p">:</span>
            <span class="n">allow_header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">allowed</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">405</span><span class="p">,</span> <span class="s2">&quot;Method not allowed.&quot;</span><span class="p">,</span> <span class="n">Allow</span><span class="o">=</span><span class="n">allow_header</span><span class="p">)</span>

        <span class="c1"># No matching route and no alternative method found. We give up</span>
        <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Not found: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>






<div class="viewcode-block" id="Route"><a class="viewcode-back" href="../api.html#bottle.Route">[docs]</a><span class="k">class</span> <span class="nc">Route</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 이 클래스는 라우트 콜백과 라우트별 메타데이터 및 설정을 감싸고</span>
<span class="sd">        있으면서 필요에 따라 플러그인들을 적용한다. 또한 URL 경로 규칙을</span>
<span class="sd">        Router에서 쓸 수 있는 정규 표현식으로 바꾸는 일도 맡는다.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiplist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">):</span>
        <span class="c1">#: 이 라우트가 설치된 응용.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="c1">#: 경로 규칙 문자열. (예: ``/wiki/:page``)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="c1">#: HTTP 메소드 문자열. (예: ``GET``)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="c1">#: 어떤 플러그인도 적용되지 않은 원래 콜백. 인트로스펙션에 유용함.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="c1">#: 라우트의 이름. 지정돼 있지 않으면 ``None``.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="c1">#: 라우트별 플러그인 목록. (:meth:`Bottle.route` 참고.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="n">plugins</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1">#: 이 라우트에 적용하지 않을 플러그인 목록. (:meth:`Bottle.route` 참고.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="o">=</span> <span class="n">skiplist</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1">#: :meth:`Bottle.route` 데코레이터에 추가로 준 키워드 인자들이</span>
        <span class="c1">#: 이 딕셔너리에 저장된다. 라우트별 플러그인 설정 및 메타데이터에</span>
        <span class="c1">#: 쓰인다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">()</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">make_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="n">depr</span><span class="p">(</span><span class="s2">&quot;Some APIs changed to return Route() instances instead of&quot;</span>\
             <span class="s2">&quot; callables. Make sure to use the Route.call method and not to&quot;</span>\
             <span class="s2">&quot; call Route instances directly.&quot;</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

<div class="viewcode-block" id="Route.call"><a class="viewcode-back" href="../api.html#bottle.Route.call">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 모든 플러그인이 적용된 라우트 콜백. 이 프로퍼티는 필요에 따라</span>
<span class="sd">            생성되며 캐싱 해서 이후 요청 처리 속도를 높인다.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="Route.reset"><a class="viewcode-back" href="../api.html#bottle.Route.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 캐싱 된 값이 있으면 잊기. 다음 :attr:`call` 접근 때 모든</span>
<span class="sd">            플러그인이 재적용된다. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;call&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Route.prepare"><a class="viewcode-back" href="../api.html#bottle.Route.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 모든 온디맨드 작업을 즉시 하기. (디버깅에 유용)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Switch to Plugin API v2 and access the Route object directly.&#39;</span><span class="p">)</span>  <span class="c1">#0.12</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">apply</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span><span class="p">)</span>

<div class="viewcode-block" id="Route.all_plugins"><a class="viewcode-back" href="../api.html#bottle.Route.all_plugins">[docs]</a>    <span class="k">def</span> <span class="nf">all_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 이 라우트에 영향 주는 모든 플러그인 내놓기. &#39;&#39;&#39;</span>
        <span class="n">unique</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">plugins</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">):</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">unique</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">unique</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">p</span></div>

    <span class="k">def</span> <span class="nf">_make_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_plugins</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">):</span>
                    <span class="n">api</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">api</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="n">plugin</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">RouteReset</span><span class="p">:</span> <span class="c1"># Try again with changed configuration.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_callback</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
                <span class="n">update_wrapper</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">callback</span>

<div class="viewcode-block" id="Route.get_undecorated_callback"><a class="viewcode-back" href="../api.html#bottle.Route.get_undecorated_callback">[docs]</a>    <span class="k">def</span> <span class="nf">get_undecorated_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 콜백 반환. 콜백이 데코레이터로 꾸민 함수면 원래 함수를</span>
<span class="sd">            복원하려고 시도한다. &#39;&#39;&#39;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">closure_attr</span> <span class="o">=</span> <span class="s1">&#39;__closure__&#39;</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="s1">&#39;func_closure&#39;</span>
        <span class="k">while</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">):</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span>
        <span class="k">return</span> <span class="n">func</span></div>

<div class="viewcode-block" id="Route.get_callback_args"><a class="viewcode-back" href="../api.html#bottle.Route.get_callback_args">[docs]</a>    <span class="k">def</span> <span class="nf">get_callback_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 콜백이 키워드 인자로 (아마도) 받는 인자 이름들의 목록 반환.</span>
<span class="sd">            콜백이 데코레이터로 꾸민 함수면 인트로스펙션 전에 원래 함수를</span>
<span class="sd">            복원하려고 시도한다. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">getargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_undecorated_callback</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Route.get_config"><a class="viewcode-back" href="../api.html#bottle.Route.get_config">[docs]</a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 설정 필드를 검색해서 그 값을 반환. 먼저 route.config를</span>
<span class="sd">            확인하고 다음으로 route.app.config 확인.&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">conifg</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">:</span> <span class="k">return</span> <span class="n">conf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">default</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_undecorated_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span></div>






<span class="c1">###############################################################################</span>
<span class="c1"># Application Object ###########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="Bottle"><a class="viewcode-back" href="../api.html#bottle.Bottle">[docs]</a><span class="k">class</span> <span class="nc">Bottle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 각 Bottle 객체는 하나의 구별된 웹 응용을 나타내며, 라우트와 콜백,</span>
<span class="sd">        플러그인, 자원, 설정으로 구성된다. 인스턴스는 호출 가능한 WSGI</span>
<span class="sd">        응용이다.</span>

<span class="sd">        :param catchall: 참(기본)이면 모든 예외를 처리한다. 디버깅용</span>
<span class="sd">                         미들웨어가 예외를 처리하게 하려면 끄면 된다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catchall</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autojson</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1">#: 앱 설정을 위한 :class:`ConfigDict`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_on_change</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_set</span><span class="p">(</span><span class="s1">&#39;autojson&#39;</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_set</span><span class="p">(</span><span class="s1">&#39;catchall&#39;</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catchall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catchall</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;autojson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autojson</span>

        <span class="c1">#: 응용 파일들을 위한 :class:`ResourceManager`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">ResourceManager</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of installed :class:`Route` instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">()</span> <span class="c1"># Maps requests to :class:`Route` instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Core plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of installed plugins.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;autojson&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">JSONPlugin</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">TemplatePlugin</span><span class="p">())</span>

    <span class="c1">#: 참이면 대부분의 예외를 잡아서 :exc:`HTTPError`\로 반환한다.</span>
    <span class="n">catchall</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;catchall&#39;</span><span class="p">)</span>

    <span class="n">__hook_names</span> <span class="o">=</span> <span class="s1">&#39;before_request&#39;</span><span class="p">,</span> <span class="s1">&#39;after_request&#39;</span><span class="p">,</span> <span class="s1">&#39;app_reset&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span>
    <span class="n">__hook_reversed</span> <span class="o">=</span> <span class="s1">&#39;after_request&#39;</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hook_names</span><span class="p">)</span>

<div class="viewcode-block" id="Bottle.add_hook"><a class="viewcode-back" href="../api.html#bottle.Bottle.add_hook">[docs]</a>    <span class="k">def</span> <span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 훅에 콜백 붙이기. 현재 세 가지 훅이 구현돼 있다.</span>

<span class="sd">            before_request</span>
<span class="sd">                각 요청 전에 한 번 실행. 요청 문맥은 사용할 수 있지만</span>
<span class="sd">                아직 라우팅은 이뤄지지 않은 상태.</span>
<span class="sd">            after_request</span>
<span class="sd">                각 요청 후에 그 결과와 상관없이 한 번 실행.</span>
<span class="sd">            app_reset</span>
<span class="sd">                :meth:`Bottle.reset`\이 호출될 때마다 호출.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hook_reversed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.remove_hook"><a class="viewcode-back" href="../api.html#bottle.Bottle.remove_hook">[docs]</a>    <span class="k">def</span> <span class="nf">remove_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 훅에서 콜백 제거. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="ow">and</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Bottle.trigger_hook"><a class="viewcode-back" href="../api.html#bottle.Bottle.trigger_hook">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 훅을 실행하고 결과 리스트 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hook</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">__name</span><span class="p">][:]]</span></div>

<div class="viewcode-block" id="Bottle.hook"><a class="viewcode-back" href="../api.html#bottle.Bottle.hook">[docs]</a>    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 훅에 콜백을 붙이는 데코레이터 반환. 자세한 내용은</span>
<span class="sd">            :meth:`add_hook` 참고.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span>
        <span class="k">return</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="Bottle.mount"><a class="viewcode-back" href="../api.html#bottle.Bottle.mount">[docs]</a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 응용(:class:`Bottle` 또는 단순 WSGI)을 특정 URL 프리픽스에</span>
<span class="sd">            마운트. 예::</span>

<span class="sd">                root_app.mount(&#39;/admin/&#39;, admin_app)</span>

<span class="sd">            :param prefix: 경로 프리픽스 내지 `마운트 지점`. 슬래시로</span>
<span class="sd">                끝나면 그 슬래시가 꼭 있어야 함.</span>
<span class="sd">            :param app: :class:`Bottle` 인스턴스 또는 WSGI 응용.</span>

<span class="sd">            다른 매개변수들이 모두 하위 :meth:`route` 호출로 전달된다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Parameter order of Bottle.mount() changed.&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># 0.10</span>

        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">segments</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Empty path prefix.&#39;</span><span class="p">)</span>
        <span class="n">path_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mountpoint_wrapper</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">path_shift</span><span class="p">(</span><span class="n">path_depth</span><span class="p">)</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="n">HTTPResponse</span><span class="p">([])</span>
                <span class="k">def</span> <span class="nf">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headerlist</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_raise</span><span class="p">(</span><span class="o">*</span><span class="n">exc_info</span><span class="p">)</span>
                        <span class="k">finally</span><span class="p">:</span>
                            <span class="n">exc_info</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headerlist</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">app</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">body</span> <span class="ow">and</span> <span class="n">rs</span><span class="o">.</span><span class="n">body</span><span class="p">:</span> <span class="n">body</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="ow">or</span> <span class="n">rs</span><span class="o">.</span><span class="n">body</span>
                <span class="k">return</span> <span class="n">rs</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">path_shift</span><span class="p">(</span><span class="o">-</span><span class="n">path_depth</span><span class="p">)</span>

        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;PROXY&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">app</span><span class="p">})</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;callback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mountpoint_wrapper</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/&lt;:re:.*&gt;&#39;</span> <span class="o">%</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.merge"><a class="viewcode-back" href="../api.html#bottle.Bottle.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 다른 :class:`Bottle` 응용의 라우트나 :class:`Route` 객체 리스트를</span>
<span class="sd">            이 응용으로 병합. 라우트의 &#39;소유자&#39;가 그대로 유지된다. 즉</span>
<span class="sd">            :data:`Route.app` 속성이 바뀌지 않는다. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">routes</span><span class="p">,</span> <span class="n">Bottle</span><span class="p">):</span>
            <span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="o">.</span><span class="n">routes</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.install"><a class="viewcode-back" href="../api.html#bottle.Bottle.install">[docs]</a>    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; plugin을 플러그인 목록에 추가하고 이 응용의 모든 라우트에</span>
<span class="sd">            적용될 수 있게 준비. plugin은 단순 데코레이터일 수도 있고</span>
<span class="sd">            :class:`Plugin` API를 구현하는 객체일 수도 있다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;setup&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Plugins must be callable or implement .apply()&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plugin</span></div>

<div class="viewcode-block" id="Bottle.uninstall"><a class="viewcode-back" href="../api.html#bottle.Bottle.uninstall">[docs]</a>    <span class="k">def</span> <span class="nf">uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 플러그인 제거. 특정 플러그인을 제거하려면 인스턴스를 주면 되고,</span>
<span class="sd">            어떤 타입의 모든 플러그인을 제거하려면 그 타입 객체를, ``name``</span>
<span class="sd">            속성이 일치하는 모든 플러그인을 제거하려면 문자열을, 모든</span>
<span class="sd">            플러그인을 제거하려면 ``True``\를 주면 된다. 제거된 플러그인</span>
<span class="sd">            목록을 반환한다. &#39;&#39;&#39;</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">plugin</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">remove</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">remove</span> <span class="ow">is</span> <span class="n">plugin</span> <span class="ow">or</span> <span class="n">remove</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">remove</span><span class="p">:</span>
                <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">removed</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">removed</span></div>

<div class="viewcode-block" id="Bottle.reset"><a class="viewcode-back" href="../api.html#bottle.Bottle.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 모든 라우트를 재설정(플러그인들을 강제로 재적용)하고 캐시</span>
<span class="sd">            모두 비우기. ID나 라우트 객체를 주면 그 특정 라우트만</span>
<span class="sd">            영향받는다. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">route</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">Route</span><span class="p">):</span> <span class="n">routes</span> <span class="o">=</span> <span class="p">[</span><span class="n">route</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">routes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">route</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span> <span class="n">route</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span> <span class="n">route</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;app_reset&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.close"><a class="viewcode-back" href="../api.html#bottle.Bottle.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 응용과 설치된 모든 플러그인 닫기. &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Bottle.run"><a class="viewcode-back" href="../api.html#bottle.Bottle.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 같은 매개변수로 :func:`run` 호출. &#39;&#39;&#39;</span>
        <span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.match"><a class="viewcode-back" href="../api.html#bottle.Bottle.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 걸리는 라우트를 검색해서 (:class:`Route` , urlargs) 튜플을</span>
<span class="sd">            반환. 두 번째 값은 URL에서 추출한 매개변수들을 담은 딕셔너리다.</span>
<span class="sd">            불일치 시 :exc:`HTTPError` (404/405)를 던진다.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.get_url"><a class="viewcode-back" href="../api.html#bottle.Bottle.get_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routename</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 지정한 라우트에 걸리는 문자열을 반환. &quot;&quot;&quot;</span>
        <span class="n">scriptname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">routename</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">scriptname</span><span class="p">),</span> <span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.add_route"><a class="viewcode-back" href="../api.html#bottle.Bottle.add_route">[docs]</a>    <span class="k">def</span> <span class="nf">add_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 라우트 객체 추가. 단 :data:`Route.app` 속성은 바꾸지 않음. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">route</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">route</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">route</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span></div>

<div class="viewcode-block" id="Bottle.route"><a class="viewcode-back" href="../api.html#bottle.Bottle.route">[docs]</a>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">apply</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 요청 URL에 함수를 결속시키는 데코레이터. 예::</span>

<span class="sd">                @app.route(&#39;/hello/:name&#39;)</span>
<span class="sd">                def hello(name):</span>
<span class="sd">                    return &#39;Hello %s&#39; % name</span>

<span class="sd">            ``:name`` 부분은 와일드카드다. 자세한 문법은 :class:`Router`</span>
<span class="sd">            참고.</span>

<span class="sd">            :param path: 받을 요청 경로 또는 경로들의 목록. 경로를</span>
<span class="sd">              지정하지 않으면 함수 시그너처를 가지고 자동으로 생성한다.</span>
<span class="sd">            :param method: 받을 HTTP 메소드(`GET`, `POST`, `PUT`, ...) 또는</span>
<span class="sd">              메소드들의 목록. (기본값: `GET`)</span>
<span class="sd">            :param callback: 데코레이터 문법을 피하기 위한 선택적 지름길.</span>
<span class="sd">              ``route(..., callback=func)``\가 ``route(...)(func)``\와 같다.</span>
<span class="sd">            :param name: 이 라우트의 이름. (기본값: None)</span>
<span class="sd">            :param apply: 데코레이터 또는 플러그인 또는 플러그인들의 목록.</span>
<span class="sd">               설치돼 있는 플러그인들에 더해서 라우트 콜백에 적용된다.</span>
<span class="sd">            :param skip: 플러그인들, 플러그인 클래스들, 이름들의 목록.</span>
<span class="sd">              걸리는 플러그인은 이 라우트에 설치하지 않는다. ``True``\면</span>
<span class="sd">              모두 건너뛴다.</span>

<span class="sd">            추가 키워드 인자가 있으면 라우트별 설정에 저장돼서 플러그인들로</span>
<span class="sd">            전달된다. (:meth:`Plugin.apply` 참고.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">path</span><span class="p">,</span> <span class="n">callback</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">apply</span><span class="p">)</span>
        <span class="n">skiplist</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="c1"># TODO: Documentation and tests</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span> <span class="n">callback</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">makelist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">yieldroutes</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">verb</span> <span class="ow">in</span> <span class="n">makelist</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                    <span class="n">verb</span> <span class="o">=</span> <span class="n">verb</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                  <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">,</span> <span class="n">skiplist</span><span class="o">=</span><span class="n">skiplist</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">callback</span>
        <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="k">if</span> <span class="n">callback</span> <span class="k">else</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="Bottle.get"><a class="viewcode-back" href="../api.html#bottle.Bottle.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :meth:`route`\와 같음. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.post"><a class="viewcode-back" href="../api.html#bottle.Bottle.post">[docs]</a>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :meth:`route`\와 같되 method 매개변수가 ``POST``. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.put"><a class="viewcode-back" href="../api.html#bottle.Bottle.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :meth:`route`\와 같되 method 매개변수가 ``PUT``. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.delete"><a class="viewcode-back" href="../api.html#bottle.Bottle.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :meth:`route`\와 같되 method 매개변수가 ``DELETE``. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.error"><a class="viewcode-back" href="../api.html#bottle.Bottle.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 데코레이터: HTTP 오류 코드에 대한 출력 핸들러 등록&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)]</span> <span class="o">=</span> <span class="n">handler</span>
            <span class="k">return</span> <span class="n">handler</span>
        <span class="k">return</span> <span class="n">wrapper</span></div>

    <span class="k">def</span> <span class="nf">default_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tob</span><span class="p">(</span><span class="n">template</span><span class="p">(</span><span class="n">ERROR_PAGE_TEMPLATE</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">res</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.raw_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Invalid path string. Expected UTF-8&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">request</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;before_request&#39;</span><span class="p">)</span>
                <span class="n">route</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;route.handle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.route&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;route.url_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
                <span class="k">return</span> <span class="n">route</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;after_request&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">HTTPResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_e</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">RouteReset</span><span class="p">:</span>
            <span class="n">route</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">stacktrace</span> <span class="o">=</span> <span class="n">format_exc</span><span class="p">()</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stacktrace</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Internal Server Error&quot;</span><span class="p">,</span> <span class="n">_e</span><span class="p">(),</span> <span class="n">stacktrace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">peek</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Try to convert the parameter into something WSGI compatible and set</span>
<span class="sd">        correct HTTP headers when possible.</span>
<span class="sd">        Support: False, str, unicode, dict, HTTPResponse, HTTPError, file-like,</span>
<span class="sd">        iterable of strings and iterable of unicodes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Empty output is done here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Content-Length&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># Join lists of byte or unicode strings. Mixed lists are NOT supported</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>\
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="c1"># b&#39;abc&#39;[0:0] -&gt; b&#39;&#39;</span>
        <span class="c1"># Encode unicode strings</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
        <span class="c1"># Byte Strings are just returned</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Content-Length&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">out</span><span class="p">]</span>
        <span class="c1"># HTTPError or HTTPException (recursive, because they may wrap anything)</span>
        <span class="c1"># TODO: Handle these explicitly in handle() or make them iterable.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_error_handler</span><span class="p">)(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="c1"># File-like objects.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;wsgi.file_wrapper&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.file_wrapper&#39;</span><span class="p">](</span><span class="n">out</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">WSGIFileWrapper</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># Handle Iterables. We peek into them to detect their inner type.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">iout</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iout</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iout</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">HTTPResponse</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">_e</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;Unhandled exception&#39;</span><span class="p">,</span> <span class="n">_e</span><span class="p">(),</span> <span class="n">format_exc</span><span class="p">())</span>

        <span class="c1"># These are the inner types allowed in iterator or generator objects.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">first</span><span class="p">],</span> <span class="n">iout</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">imap</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">first</span><span class="p">],</span> <span class="n">iout</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unsupported response type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">_closeiter</span><span class="p">(</span><span class="n">new_iter</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_iter</span>

<div class="viewcode-block" id="Bottle.wsgi"><a class="viewcode-back" href="../api.html#bottle.Bottle.wsgi">[docs]</a>    <span class="k">def</span> <span class="nf">wsgi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 보틀의 WSGI 인터페이스. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
            <span class="c1"># rfc2616 section 4.3</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">_status_code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">304</span><span class="p">)</span>\
            <span class="ow">or</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_response</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_status_line</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">headerlist</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1&gt;Critical error while processing request: </span><span class="si">%s</span><span class="s1">&lt;/h1&gt;&#39;</span> \
                  <span class="o">%</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">+=</span> <span class="s1">&#39;&lt;h2&gt;Error:&lt;/h2&gt;</span><span class="se">\n</span><span class="s1">&lt;pre&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                       <span class="s1">&#39;&lt;h2&gt;Traceback:&lt;/h2&gt;</span><span class="se">\n</span><span class="s1">&lt;pre&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="n">html_escape</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">_e</span><span class="p">())),</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">format_exc</span><span class="p">()))</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html; charset=UTF-8&#39;</span><span class="p">)]</span>
            <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;500 INTERNAL SERVER ERROR&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">tob</span><span class="p">(</span><span class="n">err</span><span class="p">)]</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Each instance of :class:&#39;Bottle&#39; is a WSGI application. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsgi</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span></div>






<span class="c1">###############################################################################</span>
<span class="c1"># HTTP and WSGI Tools ##########################################################</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="BaseRequest"><a class="viewcode-back" href="../api.html#bottle.BaseRequest">[docs]</a><span class="k">class</span> <span class="nc">BaseRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; WSGI 환경 딕셔너리들의 래퍼에 여러 편리한 접근 메소드와 프로퍼티를</span>
<span class="sd">        더한 것. 대부분 읽기 전용이다.</span>

<span class="sd">        요청에 새 속성을 추가하면 실제로는 환경 딕셔너리에</span>
<span class="sd">        (&#39;bottle.request.ext.&lt;name&gt;&#39;으로) 추가된다. 요청별 데이터를</span>
<span class="sd">        저장하고 접근하는 권장 방식이다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">)</span>

    <span class="c1">#: :attr:`body`\를 위한 메모리 버퍼의 바이트 단위 최대 크기.</span>
    <span class="n">MEMFILE_MAX</span> <span class="o">=</span> <span class="mi">102400</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; WSGI environ 딕셔너리 포장. &quot;&quot;&quot;</span>
        <span class="c1">#: 포장된 WSGI environ 딕셔너리. 유일한 진짜 속성이다.</span>
        <span class="c1">#: 다른 속성들은 사실 모두 읽기 전용 프로퍼티다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">environ</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">environ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="BaseRequest.app"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.app">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.app&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 이 요청을 처리 중인 보틀 응용. &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to an application.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.route"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.route">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.route&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 이 요청에 걸린 보틀 :class:`Route` 객체. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to a route.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.url_args"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.url_args">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;route.url_args&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">url_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; URL에서 추출한 인자들. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to a route.&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; ``PATH_INFO`` 값 앞에 슬래시를 딱 한 개 붙인 것. (이상</span>
<span class="sd">            동작 클라이언트에 대처하고 &quot;빈 경로&quot; 경우를 피하기 위해.) &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; ``REQUEST_METHOD`` 값을 대문자 문자열로. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<div class="viewcode-block" id="BaseRequest.headers"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.headers">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.headers&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 대소문자 구별 없이 HTTP 요청 헤더에 접근할 수 있게 해 주는</span>
<span class="sd">            :class:`WSGIHeaderDict`. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">WSGIHeaderDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.get_header"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 요청 헤더의 값을 반환. 없으면 주어진 기본값 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.cookies"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.cookies">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.cookies&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 쿠키들을 파싱 해서 담은 :class:`FormsDict`. 서명된 쿠키가</span>
<span class="sd">            디코딩 돼 있지 않다. 서명된 쿠키에는 :meth:`get_cookie` 사용. &quot;&quot;&quot;</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_COOKIE&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">FormsDict</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.get_cookie"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.get_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">get_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 쿠키 내용물 반환. `서명된 쿠키`\를 읽으려면 `secret`\이 쿠키</span>
<span class="sd">            생성 시 사용한 값과 일치해야 한다.</span>
<span class="sd">            (:meth:`BaseResponse.set_cookie` 참고.) 뭔가 잘못되면 (쿠키가</span>
<span class="sd">            없거나 서명이 틀리면) 기본값을 반환한다. &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">secret</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">cookie_decode</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span> <span class="c1"># (key, value) tuple or None</span>
            <span class="k">return</span> <span class="n">dec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">dec</span> <span class="ow">and</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span> <span class="k">else</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">default</span></div>

<div class="viewcode-block" id="BaseRequest.query"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.query">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.query&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :attr:`query_string`\을 파싱 해서 담은 :class:`FormsDict`.</span>
<span class="sd">            이 값들을 &quot;URL 인자&quot;나 &quot;GET 매개변수&quot;라고도 하는데,</span>
<span class="sd">            :class:`Router`\에서 제공하는 &quot;URL 와일드카드&quot;와 혼동하지</span>
<span class="sd">            말아야 한다. &#39;&#39;&#39;</span>
        <span class="n">get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.get&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">_parse_qsl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">get</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">get</span></div>

<div class="viewcode-block" id="BaseRequest.forms"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.forms">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.forms&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">forms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; `url-encoded`\나 `multipart/form-data`\로 인코딩 된 POST 또는</span>
<span class="sd">            PUT 요청 바디의 양식 값들을 파싱 한 것. :class:`FormsDict`\로</span>
<span class="sd">            결과를 반환한다. 모든 키와 값이 문자열이다. 파일 업로드는</span>
<span class="sd">            :attr:`files`\에 따로 저장된다. &quot;&quot;&quot;</span>
        <span class="n">forms</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FileUpload</span><span class="p">):</span>
                <span class="n">forms</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">forms</span></div>

<div class="viewcode-block" id="BaseRequest.params"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.params">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.params&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :attr:`query`\와 :attr:`forms`\의 값을 합친 :class:`FormsDict`.</span>
<span class="sd">            파일 업로드는 :attr:`files`\에 저장된다. &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="BaseRequest.files"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.files">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.files&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; `multipart/form-data`\로 인코딩 된 POST 또는 PUT 요청 바디에서</span>
<span class="sd">            파싱 한 파일 업로드. 값들이 :class:`FileUpload`\의 인스턴스다.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FileUpload</span><span class="p">):</span>
                <span class="n">files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">files</span></div>

<div class="viewcode-block" id="BaseRequest.json"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.json">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.json&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; ``Content-Type`` 헤더가 ``application/json``\인 경우 이</span>
<span class="sd">            프로퍼티는 파싱 된 요청 바디 내용물을 담는다. 메모리 고갈을</span>
<span class="sd">            피하기 위해 :attr:`MEMFILE_MAX`\보다 작은 요청만 처리한다. &#39;&#39;&#39;</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_body_string</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">json_loads</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_iter_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
        <span class="n">maxread</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_length</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">maxread</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxread</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">yield</span> <span class="n">part</span>
            <span class="n">maxread</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iter_chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Error while parsing chunked transfer body.&#39;</span><span class="p">)</span>
        <span class="n">rn</span><span class="p">,</span> <span class="n">sem</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">),</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">rn</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">bufsize</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">sem</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">maxread</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tonat</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>
            <span class="k">if</span> <span class="n">maxread</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">while</span> <span class="n">maxread</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">buff</span><span class="p">:</span>
                    <span class="n">buff</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxread</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">))</span>
                <span class="n">part</span><span class="p">,</span> <span class="n">buff</span> <span class="o">=</span> <span class="n">buff</span><span class="p">[:</span><span class="n">maxread</span><span class="p">],</span> <span class="n">buff</span><span class="p">[</span><span class="n">maxread</span><span class="p">:]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
                <span class="k">yield</span> <span class="n">part</span>
                <span class="n">maxread</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rn</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>

    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.body&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">body_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_chunked</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_body</span>
        <span class="n">read_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span>
        <span class="n">body</span><span class="p">,</span> <span class="n">body_size</span><span class="p">,</span> <span class="n">is_temp_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">body_iter</span><span class="p">(</span><span class="n">read_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">):</span>
            <span class="n">body</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">body_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_temp_file</span> <span class="ow">and</span> <span class="n">body_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span>
                <span class="n">body</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">TemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+b&#39;</span><span class="p">),</span> <span class="n">body</span>
                <span class="n">body</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
                <span class="k">del</span> <span class="n">tmp</span>
                <span class="n">is_temp_file</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
        <span class="n">body</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">def</span> <span class="nf">_get_body_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; read body until content-length or MEMFILE_MAX into a string. Raise</span>
<span class="sd">            HTTPError(413) on requests that are to large. &#39;&#39;&#39;</span>
        <span class="n">clen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_length</span>
        <span class="k">if</span> <span class="n">clen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">413</span><span class="p">,</span> <span class="s1">&#39;Request to large&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">clen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">clen</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span> <span class="c1"># Fail fast</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">413</span><span class="p">,</span> <span class="s1">&#39;Request to large&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; seek 가능한 파일스러운 객체로 된 HTTP 요청 바디.</span>
<span class="sd">            :attr:`MEMFILE_MAX`\에 따라 임시 파일 또는 :class:`io.BytesIO`</span>
<span class="sd">            인스턴스다. 이 프로퍼티에 처음 접근할 때 환경 변수</span>
<span class="sd">            ``wsgi.input``\을 읽어서 교체한다. 이후 접근 시에는 그 파일</span>
<span class="sd">            객체에 `seek(0)`\만 한다. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_body</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; chunked 전송 인코딩이었으면 True. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;chunked&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_TRANSFER_ENCODING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1">#: :attr:`query`\의 별칭.</span>
    <span class="n">GET</span> <span class="o">=</span> <span class="n">query</span>

<div class="viewcode-block" id="BaseRequest.POST"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.POST">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.post&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :attr:`forms`\와 :attr:`files`\의 값을 하나로 합친</span>
<span class="sd">            :class:`FormsDict`. 값이 문자열(양식 값) 또는</span>
<span class="sd">            :class:`cgi.FieldStorage` 인스턴스(파일 업로드)다.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="c1"># We default to application/x-www-form-urlencoded for everything that</span>
        <span class="c1"># is not multipart and take the fast path (also: 3.1 workaround)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multipart/&#39;</span><span class="p">):</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">_parse_qsl</span><span class="p">(</span><span class="n">tonat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_body_string</span><span class="p">(),</span> <span class="s1">&#39;latin1&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">post</span>

        <span class="n">safe_env</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span> <span class="c1"># Build a safe environment for cgi</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span> <span class="n">safe_env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="n">safe_env</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">py31</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;fp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NCTextIOWrapper</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;fp&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
                                         <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;_cgi.FieldStorage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="c1">#http://bugs.python.org/issue18394#msg207958</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">list</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileUpload</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">post</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 호스트 이름과 스킴을 포함한 전체 요청 URI. 앱이 역방향 프록시나</span>
<span class="sd">            로드 밸런서 뒤에서 도는데 이상한 결과가 나온다면</span>
<span class="sd">            ``X-Forwarded-Host`` 헤더가 올바로 설정되는지 확인해 보자. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>

<div class="viewcode-block" id="BaseRequest.urlparts"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.urlparts">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.urlparts&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">urlparts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :attr:`url` 문자열을 :class:`urlparse.SplitResult` 튜플로 만든 것.</span>
<span class="sd">            그 튜플에 (scheme, host, path, query_string, fragment)가 들어있는데</span>
<span class="sd">            fragment는 서버에게 보이지 않으므로 항상 비어 있다. &#39;&#39;&#39;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wsgi.url_scheme&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">)</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_HOST&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="c1"># HTTP 1.1 requires a Host-header. This is for HTTP/1.0 clients.</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">and</span> <span class="n">port</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;80&#39;</span> <span class="k">if</span> <span class="n">http</span> <span class="o">==</span> <span class="s1">&#39;http&#39;</span> <span class="k">else</span> <span class="s1">&#39;443&#39;</span><span class="p">):</span>
                <span class="n">host</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">port</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">UrlSplitResult</span><span class="p">(</span><span class="n">http</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fullpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (존재 시) :attr:`script_name`\을 포함한 요청 경로. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">query_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; URL의 :attr:`query` 부분(``?``\와 ``#`` 사이 전부)을 그대로</span>
<span class="sd">            문자열로 만든 것. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">script_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 응용을 호출하기 전에 상위 단계(서버 또는 라우팅 미들웨어)에서</span>
<span class="sd">            제거한 URL `path`\의 첫 부분. 그 스크립트 경로 앞과 뒤에</span>
<span class="sd">            슬래시를 붙여서 반환한다. &#39;&#39;&#39;</span>
        <span class="n">script_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">script_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="k">if</span> <span class="n">script_name</span> <span class="k">else</span> <span class="s1">&#39;/&#39;</span>

<div class="viewcode-block" id="BaseRequest.path_shift"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.path_shift">[docs]</a>    <span class="k">def</span> <span class="nf">path_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :attr:`path`\에서 :attr:`script_name`\으로 또는 반대로 경로</span>
<span class="sd">            조각들을 이동.</span>

<span class="sd">            :param shift: 옮길 경로 조각 수. 음수로 해서 이동 방향을 바꿀</span>
<span class="sd">                         수도 있다. (기본값: 1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_shift</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 정수로 된 요청 바디 길이. 이 헤더를 설정할 책임이 클라이언트에게</span>
<span class="sd">            있다. 설정하지 않았으면 바디의 실제 길이를 알 수 없으므로 -1을</span>
<span class="sd">            반환한다. 그 경우 :attr:`body`\가 비어 있게 된다. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 소문자로 된 Content-Type 헤더. (기본값: 빈 문자열) &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_xhr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; XMLHttpRequest로 시작된 요청이면 True. 자바스크립트 라이브러리에서</span>
<span class="sd">            `X-Requested-With` 헤더를 지원하는 경우에만 동작한다. (인기 있는</span>
<span class="sd">            라이브러리들은 대부분 지원한다.) &#39;&#39;&#39;</span>
        <span class="n">requested_with</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">requested_with</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;xmlhttprequest&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_ajax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :attr:`is_xhr`\의 별칭. &quot;Ajax&quot;는 올바른 용어가 아니다. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_xhr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (user, password) 튜플로 된 HTTP 인증 데이터. 이 구현체에선</span>
<span class="sd">            현재 basic 인증만 지원한다. (digest는 지원하지 않는다.)</span>
<span class="sd">            상위 수준에서 (가령 프론트엔드 웹 서버나 미들웨어에서) 인증이</span>
<span class="sd">            이뤄지는 경우 password 필드가 None이지만 user 필드는</span>
<span class="sd">            환경 변수 ``REMOTE_USER``\에서 찾아 넣는다. 오류 발생 시</span>
<span class="sd">            None을 반환한다. &quot;&quot;&quot;</span>
        <span class="n">basic</span> <span class="o">=</span> <span class="n">parse_auth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basic</span><span class="p">:</span> <span class="k">return</span> <span class="n">basic</span>
        <span class="n">ruser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REMOTE_USER&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ruser</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">ruser</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 이 요청에 관련된 모든 IP 주소 목록. 클라이언트 IP로 시작해서</span>
<span class="sd">            0개 이상의 프록시가 따라온다. 모든 프록시에서 ``X-Forwarded-For``</span>
<span class="sd">            헤더를 지원하는 경우에만 동작한다. 악의적 클라이언트가 이 정보를</span>
<span class="sd">            위조할 수 있다는 점에 유의하자. &quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
        <span class="n">remote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">remote</span><span class="p">]</span> <span class="k">if</span> <span class="n">remote</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_addr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 문자열로 된 클라이언트 IP. 악의적 클라이언트가 이 정보를</span>
<span class="sd">            위조할 수 있다는 점에 유의하자. &quot;&quot;&quot;</span>
        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_route</span>
        <span class="k">return</span> <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">route</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="BaseRequest.copy"><a class="viewcode-back" href="../api.html#bottle.BaseRequest.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :attr:`environ`\을 얕게 복사한 새 :class:`Request` 반환. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Change an environ value and clear all caches that depend on it. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bottle.request.readonly&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The environ dictionary is read-only.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">todelete</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;wsgi.input&#39;</span><span class="p">:</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;forms&#39;</span><span class="p">,</span> <span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">:</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HTTP_&#39;</span><span class="p">):</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;cookies&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">todelete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bottle.request.&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Search in self.environ for additional user defined attributes. &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request.ext.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">name</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;__get__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">%r</span><span class="s1"> not defined.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;environ&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request.ext.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<span class="k">def</span> <span class="nf">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Header names must not contain control characters: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">tonat</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Header value must not contain control characters: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>



<span class="k">class</span> <span class="nc">HeaderProperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> 헤더의 현재 값.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>


<div class="viewcode-block" id="BaseResponse"><a class="viewcode-back" href="../api.html#bottle.BaseResponse">[docs]</a><span class="k">class</span> <span class="nc">BaseResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 응답 바디, 헤더, 쿠키 저장 클래스.</span>

<span class="sd">        이 클래스는 분명 헤더에 대한 대소문자 구별 없는 dict스러운 항목</span>
<span class="sd">        접근을 지원하지만 dict가 아니다. 무엇보다 응답에 반복문을 돌리면</span>
<span class="sd">        헤더가 아니라 바디의 부분들을 내놓는다.</span>

<span class="sd">        :param body: 지원 타입들 중 하나로 된 응답 바디.</span>
<span class="sd">        :param status: HTTP 상태 코드(예: 200) 또는 이유 문구를</span>
<span class="sd">                       포함한 상태 행(예: &#39;200 OK&#39;).</span>
<span class="sd">        :param headers: 이름-값 쌍의 딕셔너리 또는 리스트.</span>

<span class="sd">        추가로 준 키워드 인자들이 헤더 목록에 추가된다. 헤더 이름의</span>
<span class="sd">        밑줄이 대시로 바뀐다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_status</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">default_content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html; charset=UTF-8&#39;</span>

    <span class="c1"># Header blacklist for specific response codes</span>
    <span class="c1"># (rfc2616 section 10.2.3 and 10.3.5)</span>
    <span class="n">bad_headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">204</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,)),</span>
        <span class="mi">304</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;Allow&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Language&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Range&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Content-Md5&#39;</span><span class="p">,</span> <span class="s1">&#39;Last-Modified&#39;</span><span class="p">))}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_status</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">more_headers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">more_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="BaseResponse.copy"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 자기 사본을 반환. &#39;&#39;&#39;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">cls</span> <span class="ow">or</span> <span class="n">BaseResponse</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">BaseResponse</span><span class="p">)</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[:])</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">()</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">copy</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 문자열로 된 HTTP 상태 행. (예: ``404 Not Found``)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 정수로 된 HTTP 상태 코드. (예: 404)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span>

    <span class="k">def</span> <span class="nf">_set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">code</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">,</span> <span class="n">_HTTP_STATUS_LINES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">code</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;String status line without a reason phrase.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mi">999</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Status code out of range.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Unknown&#39;</span> <span class="o">%</span> <span class="n">code</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>

    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_status</span><span class="p">,</span> <span class="n">_set_status</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="sd">&#39;&#39;&#39; HTTP 응답 상태를 바꾸기 위한 쓰기 가능 프로퍼티. 숫자 코드</span>
<span class="sd">            (100-999) 또는 자체 이유 문구(예: &quot;404 Brain not found&quot;)가 있는</span>
<span class="sd">            문자열을 받는다. 그에 따라 :data:`status_line`\과</span>
<span class="sd">            :data:`status_code`\가 모두 갱신된다. 반환 값은 항상 상태</span>
<span class="sd">            문자열이다. &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">_get_status</span><span class="p">,</span> <span class="n">_set_status</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :class:`HeaderDict` 인스턴스. 응답 헤더들에 대한 대소문자</span>
<span class="sd">            구별 없는 dict스러운 뷰. &#39;&#39;&#39;</span>
        <span class="n">hdict</span> <span class="o">=</span> <span class="n">HeaderDict</span><span class="p">()</span>
        <span class="n">hdict</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
        <span class="k">return</span> <span class="n">hdict</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="k">return</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>  <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>

<div class="viewcode-block" id="BaseResponse.get_header"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 앞서 지정했던 헤더 값을 반환. 그 이름의 헤더가 없으면</span>
<span class="sd">            기본값 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">[</span><span class="n">default</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="BaseResponse.set_header"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.set_header">[docs]</a>    <span class="k">def</span> <span class="nf">set_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 새 응답 헤더 만들기. 앞서 같은 이름으로 지정한 헤더</span>
<span class="sd">            있으면 교체. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span></div>

<div class="viewcode-block" id="BaseResponse.add_header"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.add_header">[docs]</a>    <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 응답 헤더 추가. 중복을 제거하지 않음. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="BaseResponse.iter_headers"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.iter_headers">[docs]</a>    <span class="k">def</span> <span class="nf">iter_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; (헤더, 값) 튜플을 내놓는다. 현재 응답 상태 코드에 허용되지</span>
<span class="sd">            않는 헤더들은 건너뛴다. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerlist</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headerlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; WSGI에 부합하는 (헤더, 값) 튜플 리스트. &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_content_type</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_headers</span><span class="p">:</span>
            <span class="n">bad_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_headers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span><span class="p">]</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bad_headers</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="n">_hval</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">OutputString</span><span class="p">())))</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
    <span class="n">content_length</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">expires</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Expires&#39;</span><span class="p">,</span>
        <span class="n">reader</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
        <span class="n">writer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">http_date</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">charset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; content-type 헤더에 지정되는 문자셋 반환. (기본값: utf8) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;charset=&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;charset=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">default</span>

<div class="viewcode-block" id="BaseResponse.set_cookie"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.set_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">set_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 새 쿠키를 만들거나 기존 쿠키를 교체. `secret` 매개변수가</span>
<span class="sd">            설정돼 있으면 `서명된 쿠키`\(아래에서 설명)를 만든다.</span>

<span class="sd">            :param name: 쿠키 이름.</span>
<span class="sd">            :param value: 쿠키 값.</span>
<span class="sd">            :param secret: 서명된 쿠키에 필요한 서명 키.</span>

<span class="sd">            더불어 이 메소드는 :class:`cookie.Morsel`\에서 지원하는 모든</span>
<span class="sd">            RFC 2109 속성을 받는다. 다음이 포함된다.</span>

<span class="sd">            :param max_age: 초 단위 최대 수명. (기본값: None)</span>
<span class="sd">            :param expires: datetime 객체 또는 유닉스 타임스탬프. (기본값: None)</span>
<span class="sd">            :param domain: 쿠키 읽는 게 허용되는 도메인.</span>
<span class="sd">              (기본값: 현재 도메인)</span>
<span class="sd">            :param path: 쿠키를 지정한 경로로 제한. (기본값: 현재 경로)</span>
<span class="sd">            :param secure: 쿠키를 HTTPS 연결로 제한. (기본값: 꺼짐)</span>
<span class="sd">            :param httponly: 클라이언트 측 자바스크립트에서 이 쿠키를 읽지</span>
<span class="sd">              못하게 하기. (기본값: 꺼짐. 파이썬 2.6 이상 필요.)</span>

<span class="sd">            `expires`\와 `max_age` 어느 쪽도 설정하지 않으면 (기본값) 브라우저</span>
<span class="sd">            세션이 끝날 때 (브라우저 창이 닫히자마자) 쿠키가 만료된다.</span>

<span class="sd">            서명된 쿠키에는 pickle 가능한 어떤 객체든 저장할 수 있으며</span>
<span class="sd">            암호학적 서명을 해서 변조를 막는다. 대부분 브라우저에서 쿠키가</span>
<span class="sd">            4kb로 제한돼 있다는 걸 잊지 말자.</span>

<span class="sd">            경고: 서명된 쿠키가 암호화되는 건 아니다. (클라이언트가 여전히</span>
<span class="sd">            내용물을 볼 수 있다.) 그리고 복사 방지가 되는 것도 아니다.</span>
<span class="sd">            (클라이언트가 이전 쿠키를 재사용할 수 있다.) 주된 의도는</span>
<span class="sd">            pickle 처리를 안전하게 만드는 것이지, 클라이언트 쪽에 비밀 정보를</span>
<span class="sd">            저장하는 게 아니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">secret</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">cookie_encode</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">secret</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Secret key missing for non-string Cookie.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4096</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cookie value to long.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;max_age&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;expires&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="BaseResponse.delete_cookie"><a class="viewcode-back" href="../api.html#bottle.BaseResponse.delete_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">delete_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 쿠키 삭제. 쿠키를 만들 때와 같은 `domain` 및 `path` 설정을</span>
<span class="sd">            쓰도록 하자. &#39;&#39;&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;max_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerlist</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">out</span></div>


<span class="k">def</span> <span class="nf">local_property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;local_property() is deprecated and will be removed.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">ls</span><span class="o">.</span><span class="n">var</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Request context not initialized.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="n">ls</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">fdel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">del</span> <span class="n">ls</span><span class="o">.</span><span class="n">var</span>
    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="p">,</span> <span class="n">fset</span><span class="p">,</span> <span class="n">fdel</span><span class="p">,</span> <span class="s1">&#39;스레드 로컬 프로퍼티&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="LocalRequest"><a class="viewcode-back" href="../api.html#bottle.LocalRequest">[docs]</a><span class="k">class</span> <span class="nc">LocalRequest</span><span class="p">(</span><span class="n">BaseRequest</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 스레드마다 각기 다른 속성 집합이 있는 :class:`BaseRequest`\의</span>
<span class="sd">        스레드 로컬 서브클래스. 일반적으로 이 클래스의 전역 인스턴스는</span>
<span class="sd">        하나만(:data:`request`) 있다. 요청/응답 처리 사이클 중 접근 시</span>
<span class="sd">        그 인스턴스는 (다중 스레드 서버에서도) 항상 *현재* 요청을</span>
<span class="sd">        가리킨다. &#39;&#39;&#39;</span>
    <span class="n">bind</span> <span class="o">=</span> <span class="n">BaseRequest</span><span class="o">.</span><span class="fm">__init__</span>
    <span class="n">environ</span> <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span></div>


<div class="viewcode-block" id="LocalResponse"><a class="viewcode-back" href="../api.html#bottle.LocalResponse">[docs]</a><span class="k">class</span> <span class="nc">LocalResponse</span><span class="p">(</span><span class="n">BaseResponse</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 스레드마다 각기 다른 속성 집합이 있는 :class:`BaseResponse`\의</span>
<span class="sd">        스레드 로컬 서브클래스. 일반적으로 이 클래스의 전역 인스턴스는</span>
<span class="sd">        하나만(:data:`response`) 있다. 요청/응답 처리 사이클 마지막에</span>
<span class="sd">        그 속성들을 사용해 HTTP 응답을 만든다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">bind</span> <span class="o">=</span> <span class="n">BaseResponse</span><span class="o">.</span><span class="fm">__init__</span>
    <span class="n">_status_line</span> <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span>
    <span class="n">_status_code</span> <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span>
    <span class="n">_cookies</span>     <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span>
    <span class="n">_headers</span>     <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span>
    <span class="n">body</span>         <span class="o">=</span> <span class="n">local_property</span><span class="p">()</span></div>


<span class="n">Request</span> <span class="o">=</span> <span class="n">BaseRequest</span>
<span class="n">Response</span> <span class="o">=</span> <span class="n">BaseResponse</span>


<div class="viewcode-block" id="HTTPResponse"><a class="viewcode-back" href="../api.html#bottle.HTTPResponse">[docs]</a><span class="k">class</span> <span class="nc">HTTPResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">,</span> <span class="n">BottleException</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTTPResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_status_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_status_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span>
        <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span></div>


<div class="viewcode-block" id="HTTPError"><a class="viewcode-back" href="../api.html#bottle.HTTPError">[docs]</a><span class="k">class</span> <span class="nc">HTTPError</span><span class="p">(</span><span class="n">HTTPResponse</span><span class="p">):</span>
    <span class="n">default_status</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="n">exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">traceback</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTTPError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>





<span class="c1">###############################################################################</span>
<span class="c1"># Plugins ######################################################################</span>
<span class="c1">###############################################################################</span>

<span class="k">class</span> <span class="nc">PluginError</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span> <span class="k">pass</span>


<span class="k">class</span> <span class="nc">JSONPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
    <span class="n">api</span>  <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_dumps</span><span class="o">=</span><span class="n">json_dumps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_dumps</span> <span class="o">=</span> <span class="n">json_dumps</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="n">dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_dumps</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dumps</span><span class="p">:</span> <span class="k">return</span> <span class="n">callback</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">HTTPError</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">_e</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1">#Attempt to serialize, raises exception on failure</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                <span class="c1">#Set content type only if serialization succesful</span>
                <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="k">return</span> <span class="n">rv</span>

        <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">TemplatePlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; This plugin applies the :func:`view` decorator to all routes with a</span>
<span class="sd">        `template` config parameter. If the parameter is a tuple, the second</span>
<span class="sd">        element must be a dict with additional options (e.g. `template_engine`)</span>
<span class="sd">        or default variables for the template. &#39;&#39;&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;template&#39;</span>
    <span class="n">api</span>  <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">conf</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="n">conf</span><span class="p">)(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">callback</span>


<span class="c1">#: Not a plugin, but part of the plugin API. TODO: Find a better place.</span>
<span class="k">class</span> <span class="nc">_ImportRedirect</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">impmask</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Create a virtual package that redirects imports (see PEP 302). &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impmask</span> <span class="o">=</span> <span class="n">impmask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_module</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;__file__&#39;</span><span class="p">:</span> <span class="vm">__file__</span><span class="p">,</span> <span class="s1">&#39;__path__&#39;</span><span class="p">:</span> <span class="p">[],</span>
                                    <span class="s1">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;__loader__&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fullname</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">packname</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">packname</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span> <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">realname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impmask</span> <span class="o">%</span> <span class="n">modname</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">realname</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">realname</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">module</span>






<span class="c1">###############################################################################</span>
<span class="c1"># Common Utilities #############################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="MultiDict"><a class="viewcode-back" href="../api.html#bottle.MultiDict">[docs]</a><span class="k">class</span> <span class="nc">MultiDict</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 이 dict는 키별로 여러 값을 저장하되 그 외는 보통 dict와 정확히</span>
<span class="sd">        똑같이 동작한다. 키를 주면 최신 값만 반환한다. 전체 값 리스트에</span>
<span class="sd">        접근하는 데 쓸 수 있는 별도의 메소드들이 있다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<div class="viewcode-block" id="MultiDict.keys"><a class="viewcode-back" href="../api.html#bottle.MultiDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

    <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">allitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">)</span>
        <span class="n">iterkeys</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="n">itervalues</span> <span class="o">=</span> <span class="n">values</span>
        <span class="n">iteritems</span> <span class="o">=</span> <span class="n">items</span>
        <span class="n">iterallitems</span> <span class="o">=</span> <span class="n">allitems</span>

    <span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="MultiDict.values"><a class="viewcode-back" href="../api.html#bottle.MultiDict.values">[docs]</a>        <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span></div>
<div class="viewcode-block" id="MultiDict.items"><a class="viewcode-back" href="../api.html#bottle.MultiDict.items">[docs]</a>        <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span></div>
<div class="viewcode-block" id="MultiDict.iterkeys"><a class="viewcode-back" href="../api.html#bottle.MultiDict.iterkeys">[docs]</a>        <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">()</span></div>
<div class="viewcode-block" id="MultiDict.itervalues"><a class="viewcode-back" href="../api.html#bottle.MultiDict.itervalues">[docs]</a>        <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">())</span></div>
<div class="viewcode-block" id="MultiDict.iteritems"><a class="viewcode-back" href="../api.html#bottle.MultiDict.iteritems">[docs]</a>        <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span></div>
        <span class="k">def</span> <span class="nf">iterallitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">allitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">]</span>

<div class="viewcode-block" id="MultiDict.get"><a class="viewcode-back" href="../api.html#bottle.MultiDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 키에 대한 최신 값을 반환.</span>

<span class="sd">            :param default: 키가 없거나 타입 변환이 실패한 경우 반환할</span>
<span class="sd">                   기본값.</span>
<span class="sd">            :param index: 사용 가능 값 리스트에 대한 색인.</span>
<span class="sd">            :param type: 지정돼 있으면 그 콜러블을 이용해 값을 특정 타입으로</span>
<span class="sd">                    캐스트 한다. 예외 발생 시 숨기고 기본값을 반환한다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span> <span class="k">else</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">default</span></div>

<div class="viewcode-block" id="MultiDict.append"><a class="viewcode-back" href="../api.html#bottle.MultiDict.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 이 키에 대한 값 리스트에 새 값을 추가. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDict.replace"><a class="viewcode-back" href="../api.html#bottle.MultiDict.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 값 리스트를 값 하나로 교체. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultiDict.getall"><a class="viewcode-back" href="../api.html#bottle.MultiDict.getall">[docs]</a>    <span class="k">def</span> <span class="nf">getall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 키에 대한 (비어 있을 수 있는) 값 리스트 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span></div>

    <span class="c1">#: 다른 multi-dict API (Django)를 흉내내는 WTForms용 에일리어스.</span>
    <span class="n">getone</span> <span class="o">=</span> <span class="n">get</span>
    <span class="n">getlist</span> <span class="o">=</span> <span class="n">getall</span></div>


<div class="viewcode-block" id="FormsDict"><a class="viewcode-back" href="../api.html#bottle.FormsDict">[docs]</a><span class="k">class</span> <span class="nc">FormsDict</span><span class="p">(</span><span class="n">MultiDict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 요청 양식 데이터를 저장하는 데 쓰는 :class:`MultiDict`\의</span>
<span class="sd">        서브클래스. 일반 dict스러운 항목 접근 방법(데이터를 그대로</span>
<span class="sd">        네이티브 문자열로 반환)에 더해서 이 컨테이너는 속성처럼 값에</span>
<span class="sd">        접근하는 것도 지원한다. 속성은 :attr:`input_encoding`\(기본값:</span>
<span class="sd">        &#39;utf8&#39;)에 맞도록 자동으로 디코딩 또는 재코딩 된다. 없는 속성은</span>
<span class="sd">        기본으로 빈 문자열을 내놓는다. &#39;&#39;&#39;</span>

    <span class="c1">#: 속성 값에 쓰는 인코딩.</span>
    <span class="n">input_encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
    <span class="c1">#: 참(기본값)이면 유니코드열을 먼저 `latin1`\으로 인코딩 한 다음</span>
    <span class="c1">#: :attr:`input_encoding`\에 맞게 디코딩 한다.</span>
    <span class="n">recode_unicode</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recode_unicode</span><span class="p">:</span> <span class="c1"># Python 3 WSGI</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span> <span class="c1"># Python 2 WSGI</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="FormsDict.decode"><a class="viewcode-back" href="../api.html#bottle.FormsDict.decode">[docs]</a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; :attr:`input_encoding`\에 맞게 디코딩 또는 재코딩 된 전체</span>
<span class="sd">            키와 값의 사본 반환. 어떤 라이브러리(예: WTForms)는</span>
<span class="sd">            유니코드 딕셔너리를 원한다. &#39;&#39;&#39;</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">input_encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">recode_unicode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">enc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">enc</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">copy</span></div>

<div class="viewcode-block" id="FormsDict.getunicode"><a class="viewcode-back" href="../api.html#bottle.FormsDict.getunicode">[docs]</a>    <span class="k">def</span> <span class="nf">getunicode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 유니코드열로 된 값, 또는 default 반환. &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">default</span></div>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">unicode</span><span class="p">()):</span>
        <span class="c1"># Without this guard, pickle generates a cryptic TypeError:</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormsDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getunicode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="HeaderDict"><a class="viewcode-back" href="../api.html#bottle.HeaderDict">[docs]</a><span class="k">class</span> <span class="nc">HeaderDict</span><span class="p">(</span><span class="n">MultiDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; :class:`MultiDict`\의 대소문자 구별 없는 버전이며 원래처럼</span>
<span class="sd">        값을 덧붙이지 않고 이전 값을 교체함. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">ka</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
<div class="viewcode-block" id="HeaderDict.append"><a class="viewcode-back" href="../api.html#bottle.HeaderDict.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>
<div class="viewcode-block" id="HeaderDict.replace"><a class="viewcode-back" href="../api.html#bottle.HeaderDict.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span></div>
<div class="viewcode-block" id="HeaderDict.getall"><a class="viewcode-back" href="../api.html#bottle.HeaderDict.getall">[docs]</a>    <span class="k">def</span> <span class="nf">getall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="ow">or</span> <span class="p">[]</span></div>
<div class="viewcode-block" id="HeaderDict.get"><a class="viewcode-back" href="../api.html#bottle.HeaderDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MultiDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">default</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="WSGIHeaderDict"><a class="viewcode-back" href="../api.html#bottle.WSGIHeaderDict">[docs]</a><span class="k">class</span> <span class="nc">WSGIHeaderDict</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; WSGI environ dict를 포장해서 HTTP_* 필드에 편리하게 접근할 수 있게</span>
<span class="sd">        하는 dict스러운 클래스. 키와 값은 네이티브 문자열(2.x는 bytes,</span>
<span class="sd">        3.x는 unicode)이며 키는 대소문자 구별이 없다. WSGI 환경에 네이티브</span>
<span class="sd">        아닌 문자열 값이 들어 있으면 무손실 &#39;latin1&#39; 문자셋을 이용해</span>
<span class="sd">        디코딩 또는 인코딩 한다.</span>

<span class="sd">        관련 PEP가 바뀌는 경우에도 API가 안정적으로 유지될 것이다.</span>
<span class="sd">        현재 PEP 333, 444, 3333을 지원한다. (PEP 444는 네이티브 아닌</span>
<span class="sd">        문자열을 쓰는 유일한 PEP다.)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#: ``HTTP_``\로 시작하지 않는 키들의 목록.</span>
    <span class="n">cgikeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>

    <span class="k">def</span> <span class="nf">_ekey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Translate header field name to CGI/WSGI environ key. &#39;&#39;&#39;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgikeys</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span>
        <span class="k">return</span> <span class="s1">&#39;HTTP_&#39;</span> <span class="o">+</span> <span class="n">key</span>

<div class="viewcode-block" id="WSGIHeaderDict.raw"><a class="viewcode-back" href="../api.html#bottle.WSGIHeaderDict.raw">[docs]</a>    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 헤더 값을 그대로 (bytes 또는 unicode) 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">default</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tonat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">)],</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is read-only.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is read-only.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HTTP_&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgikeys</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

<div class="viewcode-block" id="WSGIHeaderDict.keys"><a class="viewcode-back" href="../api.html#bottle.WSGIHeaderDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span></div>



<div class="viewcode-block" id="ConfigDict"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict">[docs]</a><span class="k">class</span> <span class="nc">ConfigDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; dict스러운 설정 저장소. 네임스페이스, 값 검사, 메타데이터,</span>
<span class="sd">        변경 주시 등을 추가로 지원.</span>

<span class="sd">        이 저장소는 빠른 읽기 접근이 가능하게 최적화돼 있다. 키를</span>
<span class="sd">        가져오거나 변경 없는 dict 메소드(예: `dict.get()`) 사용 시</span>
<span class="sd">        원래 dict 대비 오버헤드가 전혀 없다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_meta&#39;</span><span class="p">,</span> <span class="s1">&#39;_on_change&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Namespace</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">=</span> <span class="n">namespace</span>

        <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Accessing namespaces as dicts is discouraged. &#39;</span>
                 <span class="s1">&#39;Only use flat item access: &#39;</span>
                 <span class="s1">&#39;cfg[&quot;names&quot;][&quot;pace&quot;][&quot;key&quot;] -&gt; cfg[&quot;name.space.key&quot;]&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>

        <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">ns_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">:</span>
                <span class="n">ns</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ns</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">name</span>

        <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>
        <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;&lt;Config.Namespace </span><span class="si">%s</span><span class="s1">.*&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span>
        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;&lt;Config.Namespace </span><span class="si">%s</span><span class="s1">.*&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span>

        <span class="c1"># Deprecated ConfigDict features</span>
        <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Attribute access is deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;_config&#39;</span><span class="p">,</span> <span class="s1">&#39;_prefix&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">return</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Attribute assignment is deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Read-only attribute.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Non-empty namespace attribute.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="n">key</span><span class="p">]</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Calling ConfDict is deprecated. Use the update() method.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">ka</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Constructor does no longer accept parameters.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

<div class="viewcode-block" id="ConfigDict.load_config"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.load_config">[docs]</a>    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; *.ini 방식 설정 파일에서 값 읽어 들이기.</span>

<span class="sd">            설정 파일에 섹션이 있으면 그 이름을 네임스페이스로 해서</span>
<span class="sd">            값을 넣는다. 두 가지 특수 섹션 ``DEFAULT``\와 ``bottle``\은</span>
<span class="sd">            루트 네임스페이스(프리픽스 없음)를 가리킨다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle&#39;</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">section</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ConfigDict.load_dict"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.load_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">make_namespaces</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 딕셔너리 구조에서 값 가져오기. 중첩 구조를 써서 네임스페이스를</span>
<span class="sd">            나타낼 수 있다.</span>

<span class="sd">            &gt;&gt;&gt; ConfigDict().load_dict({&#39;name&#39;: {&#39;space&#39;: {&#39;key&#39;: &#39;value&#39;}}})</span>
<span class="sd">            {&#39;name.space.key&#39;: &#39;value&#39;}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">source</span><span class="p">)]</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Source is not a dict (r)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Key is not a string (</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="n">full_key</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="n">key</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">full_key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">make_namespaces</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">full_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">full_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ConfigDict.update"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 첫 번째 매개변수가 문자열이면 모든 키 이름 앞에 그 네임스페이스를</span>
<span class="sd">            붙인다. 그 경우 외에는 일반 dict.update()처럼 동작한다.</span>
<span class="sd">            예: ``update(&#39;some.namespace&#39;, key=&#39;value&#39;)`` &#39;&#39;&#39;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="ConfigDict.setdefault"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.setdefault">[docs]</a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Key has type </span><span class="si">%r</span><span class="s1"> (not a string)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="ConfigDict.clear"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="ConfigDict.meta_get"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.meta_get">[docs]</a>    <span class="k">def</span> <span class="nf">meta_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">metafield</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 키에 대한 메타 필드 값을 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metafield</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigDict.meta_set"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">metafield</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 키에 대한 메타 필드에 새 값 설정. 기존 키에 대한 변경</span>
<span class="sd">            핸들러 실행을 일으킨다. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})[</span><span class="n">metafield</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="ConfigDict.meta_list"><a class="viewcode-back" href="../configuration.html#bottle.ConfigDict.meta_list">[docs]</a>    <span class="k">def</span> <span class="nf">meta_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 키에 대해 정의된 메타 필드 이름들의 이터러블 반환. &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

    <span class="c1"># Deprecated ConfigDict features</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Attribute access is deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Attribute assignment is deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Read-only attribute.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Non-empty namespace attribute.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Calling ConfDict is deprecated. Use the update() method.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="AppStack"><a class="viewcode-back" href="../api.html#bottle.AppStack">[docs]</a><span class="k">class</span> <span class="nc">AppStack</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 스택스러운 리스트. 호출하면 스택 상단 항목 반환. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the current default application. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="AppStack.push"><a class="viewcode-back" href="../api.html#bottle.AppStack.push">[docs]</a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 스택에 새 :class:`Bottle` 인스턴스 추가. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Bottle</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Bottle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div></div>


<span class="k">class</span> <span class="nc">WSGIFileWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1024</span><span class="o">*</span><span class="mi">64</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">fp</span><span class="p">,</span> <span class="n">buffer_size</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fileno&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;readlines&#39;</span><span class="p">,</span> <span class="s1">&#39;tell&#39;</span><span class="p">,</span> <span class="s1">&#39;seek&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buff</span><span class="p">,</span> <span class="n">read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">return</span>
            <span class="k">yield</span> <span class="n">part</span>


<span class="k">class</span> <span class="nc">_closeiter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; This only exists to be able to attach a .close method to iterators that</span>
<span class="sd">        do not support attribute assignment (most of itertools). &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_callbacks</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">close</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_callbacks</span><span class="p">:</span>
            <span class="n">func</span><span class="p">()</span>


<div class="viewcode-block" id="ResourceManager"><a class="viewcode-back" href="../api.html#bottle.ResourceManager">[docs]</a><span class="k">class</span> <span class="nc">ResourceManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 탐색 경로 목록을 관리하고 응용 관련 자원(파일)을 찾아서</span>
<span class="sd">        여는 걸 돕는 클래스.</span>

<span class="sd">        :param base: :meth:`add_path` 호출을 위한 기본값.</span>
<span class="sd">        :param opener: 자원 여는 데 쓰는 콜러블.</span>
<span class="sd">        :param cachemode: 어떤 탐색 결과를 캐싱 할지 제어. &#39;all&#39;,</span>
<span class="sd">                         &#39;found&#39;, &#39;none&#39; 중 하나.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">opener</span><span class="o">=</span><span class="nb">open</span><span class="p">,</span> <span class="n">cachemode</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener</span> <span class="o">=</span> <span class="nb">open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="o">=</span> <span class="n">cachemode</span>

        <span class="c1">#: 탐색 경로 리스트. 자세한 건 :meth:`add_path` 참고.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: 결정된 경로의 캐시. ``res.cache.clear()``\로 캐시 비울 수 있음.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ResourceManager.add_path"><a class="viewcode-back" href="../api.html#bottle.ResourceManager.add_path">[docs]</a>    <span class="k">def</span> <span class="nf">add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 탐색 경로 리스트에 새 경로 추가. 존재하지 않는 경로면</span>
<span class="sd">            False 반환.</span>

<span class="sd">            :param path: 새 탐색 경로. 상대 경로는 정규화된 절대 경로로</span>
<span class="sd">                바꾼다. 경로가 파일처럼 생겼으면 (`/`\로 끝나지 않으면)</span>
<span class="sd">                파일명 부분을 없앤다.</span>
<span class="sd">            :param base: 상대 탐색 경로를 절대 경로로 바꾸는 데 쓰는 경로.</span>
<span class="sd">                기본은 :attr:`base` 값인데, 그 기본값은 ``os.getcwd()``.</span>
<span class="sd">            :param index: 탐색 경로 리스트 내 위치. 기본은 마지막 색인</span>
<span class="sd">                (리스트에 덧붙이기).</span>

<span class="sd">            `base` 매개변수는 파이썬 모듈 내지 패키지와 함께 설치된</span>
<span class="sd">            파일을 쉽게 참조할 수 있게 해 준다. ::</span>

<span class="sd">                res.add_path(&#39;./resources/&#39;, __file__)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">base</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">))</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Iterate over all existing files in all registered paths. &#39;&#39;&#39;</span>
        <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
        <span class="k">while</span> <span class="n">search</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">full</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full</span><span class="p">):</span> <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="n">full</span>

<div class="viewcode-block" id="ResourceManager.lookup"><a class="viewcode-back" href="../api.html#bottle.ResourceManager.lookup">[docs]</a>    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 자원을 탐색해서 파일 절대 경로를 반환. 없으면 `None` 반환.</span>

<span class="sd">            :attr:`path` 목록을 차례로 탐색한다. 처음 걸린 걸 반환한다.</span>
<span class="sd">            심볼릭 링크를 따라간다. 결과를 캐싱 해서 이후 검색 속도를</span>
<span class="sd">            높인다. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="ow">or</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;found&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpath</span>
                    <span class="k">return</span> <span class="n">fpath</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ResourceManager.open"><a class="viewcode-back" href="../api.html#bottle.ResourceManager.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 자원을 찾아서 파일 객체 반환, 또는 IOError 던짐. &#39;&#39;&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Resource </span><span class="si">%r</span><span class="s2"> not found.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FileUpload"><a class="viewcode-back" href="../api.html#bottle.FileUpload">[docs]</a><span class="k">class</span> <span class="nc">FileUpload</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Wrapper for file uploads. &#39;&#39;&#39;</span>
        <span class="c1">#: 열린 파일(스러운) 객체 (BytesIO 버퍼나 임시 파일)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">fileobj</span>
        <span class="c1">#: 업로드 양식 필드 이름</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#: 클라이언트가 보낸 그대로의 파일 이름 (안전하지 않은 문자 있을 수 있음)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c1">#: 추가 헤더들(예: content-type) 있는 :class:`HeaderDict`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">HeaderDict</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="n">HeaderDict</span><span class="p">()</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
    <span class="n">content_length</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="FileUpload.get_header"><a class="viewcode-back" href="../api.html#bottle.FileUpload.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 멀티파트 부분 안의 헤더 값 반환. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileUpload.filename"><a class="viewcode-back" href="../api.html#bottle.FileUpload.filename">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 클라이언트 파일 시스템 상의 파일 이름. 단 파일 시스템 호환성이</span>
<span class="sd">            보장되도록 정규화 돼 있음. 빈 파일 이름은 &#39;empty&#39;로 반환.</span>

<span class="sd">            최종 파일 이름에서는 ASCII 문자, 숫자, 대시, 밑줄, 마침표만</span>
<span class="sd">            허용한다. 가능한 경우 강세 표시를 없앤다. 공백을 대시 한 개로</span>
<span class="sd">            바꾼다. 앞이나 뒤의 마침표 및 대시를 제거한다. 파일 이름</span>
<span class="sd">            길이를 255문자로 제한한다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9-_.\s]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[-\s]+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fname</span><span class="p">[:</span><span class="mi">255</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;empty&#39;</span></div>

    <span class="k">def</span> <span class="nf">_copy_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">buf</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

<div class="viewcode-block" id="FileUpload.save"><a class="viewcode-back" href="../api.html#bottle.FileUpload.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; 파일을 디스크에 저장하거나 내용물을 열린 파일(스러운) 객체로</span>
<span class="sd">            복사한다. *destination*\이 디렉터리면 경로에 :attr:`filename`\을</span>
<span class="sd">            덧붙인다. 기본적으로 기존 파일을 덮어 쓰지 않는다 (IOError).</span>

<span class="sd">            :param destination: 파일 경로나 디렉터리, 파일(스러운) 객체.</span>
<span class="sd">            :param overwrite: 참이면 기본 파일을 교체. (기본값: False)</span>
<span class="sd">            :param chunk_size: 한 번에 읽을 바이트 수. (기본값: 64kb)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span> <span class="c1"># Except file-likes here</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File exists.&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span></div></div>






<span class="c1">###############################################################################</span>
<span class="c1"># Application Helper ###########################################################</span>
<span class="c1">###############################################################################</span>


<span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Unknown Error.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Aborts execution and causes a HTTP error. &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Aborts execution and causes a 303 or 302 redirect, depending on</span>
<span class="sd">        the HTTP protocol version. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">303</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_PROTOCOL&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;HTTP/1.1&quot;</span> <span class="k">else</span> <span class="mi">302</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">HTTPResponse</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">code</span>
    <span class="n">res</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">res</span><span class="o">.</span><span class="n">set_header</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
    <span class="k">raise</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_file_iter_range</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxread</span><span class="o">=</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Yield chunks from a range in a file. No chunk is bigger than maxread.&#39;&#39;&#39;</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">maxread</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">break</span>
        <span class="nb">bytes</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">part</span>


<span class="k">def</span> <span class="nf">static_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Open a file in a safe way and return :exc:`HTTPResponse` with status</span>
<span class="sd">        code 200, 305, 403 or 404. The ``Content-Type``, ``Content-Encoding``,</span>
<span class="sd">        ``Content-Length`` and ``Last-Modified`` headers are set if possible.</span>
<span class="sd">        Special support for ``If-Modified-Since``, ``Range`` and ``HEAD``</span>
<span class="sd">        requests.</span>

<span class="sd">        :param filename: Name or path of the file to send.</span>
<span class="sd">        :param root: Root path for file lookups. Should be an absolute directory</span>
<span class="sd">            path.</span>
<span class="sd">        :param mimetype: Defines the content-type header (default: guess from</span>
<span class="sd">            file extension)</span>
<span class="sd">        :param download: If True, ask the browser to open a `Save as...` dialog</span>
<span class="sd">            instead of opening the file with the associated program. You can</span>
<span class="sd">            specify a custom filename as a string. If not specified, the</span>
<span class="sd">            original filename is used (default: False).</span>
<span class="sd">        :param charset: The charset to use for files with a ``text/*``</span>
<span class="sd">            mime-type. (default: UTF-8)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)))</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;Access denied.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;File does not exist.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;You do not have permission to access this file.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mimetype</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">mimetype</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>

    <span class="k">if</span> <span class="n">mimetype</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mimetype</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text/&#39;</span> <span class="ow">and</span> <span class="n">charset</span> <span class="ow">and</span> <span class="s1">&#39;charset&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mimetype</span><span class="p">:</span>
            <span class="n">mimetype</span> <span class="o">+=</span> <span class="s1">&#39;; charset=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">charset</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mimetype</span>

    <span class="k">if</span> <span class="n">download</span><span class="p">:</span>
        <span class="n">download</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span> <span class="k">if</span> <span class="n">download</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">download</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">download</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clen</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">st_size</span>
    <span class="n">lm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>
    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Last-Modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm</span>

    <span class="n">ims</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ims</span><span class="p">:</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">ims</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">ims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ims</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">):</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

    <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Accept-Ranges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bytes&quot;</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_RANGE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;HTTP_RANGE&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_range_header</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HTTP_RANGE&#39;</span><span class="p">],</span> <span class="n">clen</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="s2">&quot;Requested Range Not Satisfiable&quot;</span><span class="p">)</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bytes </span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">clen</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">body</span><span class="p">:</span> <span class="n">body</span> <span class="o">=</span> <span class="n">_file_iter_range</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">206</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>






<span class="c1">###############################################################################</span>
<span class="c1"># HTTP Utilities and MISC (TODO) ###############################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="debug"><a class="viewcode-back" href="../api.html#bottle.debug">[docs]</a><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 디버그 수준 변경.</span>
<span class="sd">    현재 지원하는 디버그 수준은 한 가지뿐이다.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">DEBUG</span>
    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">http_date</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="parse_date"><a class="viewcode-back" href="../api.html#bottle.parse_date">[docs]</a><span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">ims</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; rfc1123, rfc850, asctime 형식 타임스탬프 파싱 해서 UTC 에포크 시간 반환. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="n">ims</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">ts</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span> <span class="o">-</span> <span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="parse_auth"><a class="viewcode-back" href="../api.html#bottle.parse_auth">[docs]</a><span class="k">def</span> <span class="nf">parse_auth</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; rfc2617 HTTP 인증 헤더 문자열(basic) 파싱 해서 (user,pass) 튜플 또는 None 반환.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">method</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;basic&#39;</span><span class="p">:</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Yield (start, end) ranges parsed from a HTTP Range header. Skip</span>
<span class="sd">        unsatisfiable ranges. The end index is non-inclusive.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span> <span class="ow">or</span> <span class="n">header</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bytes=&#39;</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>  <span class="c1"># bytes=-100    -&gt; last 100 bytes</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)),</span> <span class="n">maxlen</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>  <span class="c1"># bytes=100-    -&gt; all but the first 99 bytes</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">maxlen</span>
            <span class="k">else</span><span class="p">:</span>          <span class="c1"># bytes=100-200 -&gt; bytes 100-200 (inclusive)</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">def</span> <span class="nf">_parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">qs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pair</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">nv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">urlunquote</span><span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">urlunquote</span><span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">_lscmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compares two strings in a cryptographically safe way:</span>
<span class="sd">        Runtime is not affected by length of common prefix. &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>


<div class="viewcode-block" id="cookie_encode"><a class="viewcode-back" href="../api.html#bottle.cookie_encode">[docs]</a><span class="k">def</span> <span class="nf">cookie_encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; pickle 가능 객체 인코딩 및 서명. (바이트)열 반환. &#39;&#39;&#39;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">+</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">msg</span></div>


<div class="viewcode-block" id="cookie_decode"><a class="viewcode-back" href="../api.html#bottle.cookie_decode">[docs]</a><span class="k">def</span> <span class="nf">cookie_decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 인코딩 된 문자열 검사 및 디코딩. 객체 또는 None 반환.&#39;&#39;&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tob</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cookie_is_encoded</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">sig</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_lscmp</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())):</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="cookie_is_encoded"><a class="viewcode-back" href="../api.html#bottle.cookie_is_encoded">[docs]</a><span class="k">def</span> <span class="nf">cookie_is_encoded</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 인자가 인코딩 된 쿠키처럼 보이면 True 반환.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">html_escape</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Escape HTML special characters ``&amp;&lt;&gt;`` and quotes ``&#39;&quot;``. &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span>\
                 <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&amp;#039;&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">html_quote</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Escape and quote a string to be used as an HTTP attribute.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;#10;&#39;</span><span class="p">)</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;#13;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;#9;&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="yieldroutes"><a class="viewcode-back" href="../api.html#bottle.yieldroutes">[docs]</a><span class="k">def</span> <span class="nf">yieldroutes</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; func 매개변수의 시그너처(이름, 인자)에 맞는 라우트를 내놓는</span>
<span class="sd">    제너레이터 반환. 함수가 선택적 키워드 인자를 받는 경우 여러 라우트를</span>
<span class="sd">    내놓을 수도 있다. 예를 보면 출력을 이해하기 쉽다. ::</span>

<span class="sd">        a()         -&gt; &#39;/a&#39;</span>
<span class="sd">        b(x, y)     -&gt; &#39;/b/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">        c(x, y=5)   -&gt; &#39;/c/&lt;x&gt;&#39; 및 &#39;/c/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">        d(x=5, y=6) -&gt; &#39;/d&#39; 및 &#39;/d/&lt;x&gt;&#39; 및 &#39;/d/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">argc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">path</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;/&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">*</span> <span class="n">argc</span><span class="p">)</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">argc</span><span class="p">])</span>
    <span class="k">yield</span> <span class="n">path</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">argc</span><span class="p">:]:</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;/&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="n">arg</span>
        <span class="k">yield</span> <span class="n">path</span></div>


<div class="viewcode-block" id="path_shift"><a class="viewcode-back" href="../api.html#bottle.path_shift">[docs]</a><span class="k">def</span> <span class="nf">path_shift</span><span class="p">(</span><span class="n">script_name</span><span class="p">,</span> <span class="n">path_info</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; PATH_INFO에서 SCRIPT_NAME으로 또는 반대로 경로 조각들을 이동.</span>

<span class="sd">        :return: 수정된 경로들.</span>
<span class="sd">        :param script_name: SCRIPT_NAME 경로.</span>
<span class="sd">        :param path_info: PATH_INFO 경로.</span>
<span class="sd">        :param shift: 옮길 경로 조각 수. 음수로 해서 이동 방향을</span>
<span class="sd">          바꿀 수도 있다. (기본값: 1)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">shift</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">script_name</span><span class="p">,</span> <span class="n">path_info</span>
    <span class="n">pathlist</span> <span class="o">=</span> <span class="n">path_info</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">script_name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pathlist</span> <span class="ow">and</span> <span class="n">pathlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">pathlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">scriptlist</span> <span class="ow">and</span> <span class="n">scriptlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">scriptlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">shift</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">shift</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathlist</span><span class="p">):</span>
        <span class="n">moved</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">[:</span><span class="n">shift</span><span class="p">]</span>
        <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">scriptlist</span> <span class="o">+</span> <span class="n">moved</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">shift</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">scriptlist</span><span class="p">):</span>
        <span class="n">moved</span> <span class="o">=</span> <span class="n">scriptlist</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">moved</span> <span class="o">+</span> <span class="n">pathlist</span>
        <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">scriptlist</span><span class="p">[:</span><span class="n">shift</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="k">if</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;PATH_INFO&#39;</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Cannot shift. Nothing left from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">empty</span><span class="p">)</span>
    <span class="n">new_script_name</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scriptlist</span><span class="p">)</span>
    <span class="n">new_path_info</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_info</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pathlist</span><span class="p">:</span> <span class="n">new_path_info</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">return</span> <span class="n">new_script_name</span><span class="p">,</span> <span class="n">new_path_info</span></div>


<span class="k">def</span> <span class="nf">auth_basic</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">realm</span><span class="o">=</span><span class="s2">&quot;private&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Access denied&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Callback decorator to require HTTP auth (basic).</span>
<span class="sd">        TODO: Add route(check_auth=...) parameter. &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="n">err</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;WWW-Authenticate&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic realm=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">realm</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">err</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>


<span class="c1"># Shortcuts for common Bottle methods.</span>
<span class="c1"># They all refer to the current default application.</span>

<span class="k">def</span> <span class="nf">make_default_app_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Return a callable that relays calls to the current default app. &#39;&#39;&#39;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">(),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="n">route</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">)</span>
<span class="n">get</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
<span class="n">post</span>      <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">put</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;put&#39;</span><span class="p">)</span>
<span class="n">delete</span>    <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<span class="n">error</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
<span class="n">mount</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;mount&#39;</span><span class="p">)</span>
<span class="n">hook</span>      <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
<span class="n">install</span>   <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span>
<span class="n">uninstall</span> <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;uninstall&#39;</span><span class="p">)</span>
<span class="n">url</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;get_url&#39;</span><span class="p">)</span>







<span class="c1">###############################################################################</span>
<span class="c1"># Server Adapter ###############################################################</span>
<span class="c1">###############################################################################</span>


<span class="k">class</span> <span class="nc">ServerAdapter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CGIServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">wsgiref.handlers</span> <span class="kn">import</span> <span class="n">CGIHandler</span>
        <span class="k">def</span> <span class="nf">fixed_environ</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
        <span class="n">CGIHandler</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fixed_environ</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FlupFCGIServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">flup.server.fcgi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bindAddress&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">flup</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fcgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">WSGIRefServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">WSGIRequestHandler</span><span class="p">,</span> <span class="n">WSGIServer</span>
        <span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
        <span class="kn">import</span> <span class="nn">socket</span>

        <span class="k">class</span> <span class="nc">FixedHandler</span><span class="p">(</span><span class="n">WSGIRequestHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">address_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Prevent reverse DNS lookups please.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">WSGIRequestHandler</span><span class="o">.</span><span class="n">log_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="n">handler_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;handler_class&#39;</span><span class="p">,</span> <span class="n">FixedHandler</span><span class="p">)</span>
        <span class="n">server_cls</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server_class&#39;</span><span class="p">,</span> <span class="n">WSGIServer</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">:</span> <span class="c1"># Fix wsgiref for IPv6 addresses.</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server_cls</span><span class="p">,</span> <span class="s1">&#39;address_family&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">:</span>
                <span class="k">class</span> <span class="nc">server_cls</span><span class="p">(</span><span class="n">server_cls</span><span class="p">):</span>
                    <span class="n">address_family</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span>

        <span class="n">srv</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">server_cls</span><span class="p">,</span> <span class="n">handler_cls</span><span class="p">)</span>
        <span class="n">srv</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CherryPyServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">cherrypy</span> <span class="kn">import</span> <span class="n">wsgiserver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;bind_addr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;wsgi_app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>

        <span class="n">certfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;certfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">certfile</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;certfile&#39;</span><span class="p">]</span>
        <span class="n">keyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keyfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;keyfile&#39;</span><span class="p">]</span>

        <span class="n">server</span> <span class="o">=</span> <span class="n">wsgiserver</span><span class="o">.</span><span class="n">CherryPyWSGIServer</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">certfile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">ssl_certificate</span> <span class="o">=</span> <span class="n">certfile</span>
        <span class="k">if</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">ssl_private_key</span> <span class="o">=</span> <span class="n">keyfile</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">WaitressServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">waitress</span> <span class="kn">import</span> <span class="n">serve</span>
        <span class="n">serve</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PasteServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">paste</span> <span class="kn">import</span> <span class="n">httpserver</span>
        <span class="kn">from</span> <span class="nn">paste.translogger</span> <span class="kn">import</span> <span class="n">TransLogger</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">TransLogger</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">setup_console_handler</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">))</span>
        <span class="n">httpserver</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span>
                         <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MeinheldServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">meinheld</span> <span class="kn">import</span> <span class="n">server</span>
        <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FapwsServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extremely fast webserver using libev. See http://www.fapws.org/ &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">fapws._evwsgi</span> <span class="k">as</span> <span class="nn">evwsgi</span>
        <span class="kn">from</span> <span class="nn">fapws</span> <span class="kn">import</span> <span class="n">base</span><span class="p">,</span> <span class="n">config</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">SERVER_IDENT</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="c1"># fapws3 silently changed its API in 0.5</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="c1"># fapws3 never releases the GIL. Complain upstream. I tried. No luck.</span>
        <span class="k">if</span> <span class="s1">&#39;BOTTLE_CHILD&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;WARNING: Auto-reloading does not work with Fapws3.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;         (Fapws3 breaks python thread support)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">set_base_module</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.multiprocess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">wsgi_cb</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">))</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TornadoServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The super hyped asynchronous server by facebook. Untested. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">tornado.wsgi</span><span class="o">,</span> <span class="nn">tornado.httpserver</span><span class="o">,</span> <span class="nn">tornado.ioloop</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIContainer</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span><span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AppEngineServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adapter for Google App Engine. &quot;&quot;&quot;</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">google.appengine.ext.webapp</span> <span class="kn">import</span> <span class="n">util</span>
        <span class="c1"># A main() function in the handler script enables &#39;App Caching&#39;.</span>
        <span class="c1"># Lets makes sure it is there. This _really_ improves performance.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">):</span>
            <span class="n">module</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TwistedServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">twisted.web</span> <span class="kn">import</span> <span class="n">server</span><span class="p">,</span> <span class="n">wsgi</span>
        <span class="kn">from</span> <span class="nn">twisted.python.threadpool</span> <span class="kn">import</span> <span class="n">ThreadPool</span>
        <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
        <span class="n">thread_pool</span> <span class="o">=</span> <span class="n">ThreadPool</span><span class="p">()</span>
        <span class="n">thread_pool</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">addSystemEventTrigger</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;shutdown&#39;</span><span class="p">,</span> <span class="n">thread_pool</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIResource</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">thread_pool</span><span class="p">,</span> <span class="n">handler</span><span class="p">))</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">listenTCP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">DieselServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">diesel.protocols.wsgi</span> <span class="kn">import</span> <span class="n">WSGIApplication</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">WSGIApplication</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GeventServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. Options:</span>

<span class="sd">        * `fast` (default: False) uses libevent&#39;s http server, but has some</span>
<span class="sd">          issues: No streaming, no pipelining, no SSL.</span>
<span class="sd">        * See gevent.wsgi.WSGIServer() documentation for more options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">gevent</span> <span class="kn">import</span> <span class="n">pywsgi</span><span class="p">,</span> <span class="n">local</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">(),</span> <span class="n">local</span><span class="o">.</span><span class="n">local</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Bottle requires gevent.monkey.patch_all() (before import)&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;The &quot;fast&quot; option has been deprecated and removed by Gevent.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">pywsgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;BOTTLE_CHILD&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">signal</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
        <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GeventSocketIOServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">socketio</span> <span class="kn">import</span> <span class="n">server</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">SocketIOServer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GunicornServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. See http://gunicorn.org/configure.html for options. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">gunicorn.app.base</span> <span class="kn">import</span> <span class="n">Application</span>

        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))}</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">GunicornApplication</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">config</span>

            <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">handler</span>

        <span class="n">GunicornApplication</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">EventletServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">eventlet</span> <span class="kn">import</span> <span class="n">wsgi</span><span class="p">,</span> <span class="n">listen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wsgi</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">listen</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)),</span> <span class="n">handler</span><span class="p">,</span>
                        <span class="n">log_output</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># Fallback, if we have old version of eventlet</span>
            <span class="n">wsgi</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">listen</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)),</span> <span class="n">handler</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RocketServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">rocket</span> <span class="kn">import</span> <span class="n">Rocket</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">Rocket</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span> <span class="s1">&#39;wsgi&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;wsgi_app&#39;</span> <span class="p">:</span> <span class="n">handler</span> <span class="p">})</span>
        <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BjoernServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fast server written in C: https://github.com/jonashaag/bjoern &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">bjoern</span> <span class="kn">import</span> <span class="n">run</span>
        <span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AutoServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>
    <span class="n">adapters</span> <span class="o">=</span> <span class="p">[</span><span class="n">WaitressServer</span><span class="p">,</span> <span class="n">PasteServer</span><span class="p">,</span> <span class="n">TwistedServer</span><span class="p">,</span> <span class="n">CherryPyServer</span><span class="p">,</span> <span class="n">WSGIRefServer</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapters</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>

<span class="n">server_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cgi&#39;</span><span class="p">:</span> <span class="n">CGIServer</span><span class="p">,</span>
    <span class="s1">&#39;flup&#39;</span><span class="p">:</span> <span class="n">FlupFCGIServer</span><span class="p">,</span>
    <span class="s1">&#39;wsgiref&#39;</span><span class="p">:</span> <span class="n">WSGIRefServer</span><span class="p">,</span>
    <span class="s1">&#39;waitress&#39;</span><span class="p">:</span> <span class="n">WaitressServer</span><span class="p">,</span>
    <span class="s1">&#39;cherrypy&#39;</span><span class="p">:</span> <span class="n">CherryPyServer</span><span class="p">,</span>
    <span class="s1">&#39;paste&#39;</span><span class="p">:</span> <span class="n">PasteServer</span><span class="p">,</span>
    <span class="s1">&#39;fapws3&#39;</span><span class="p">:</span> <span class="n">FapwsServer</span><span class="p">,</span>
    <span class="s1">&#39;tornado&#39;</span><span class="p">:</span> <span class="n">TornadoServer</span><span class="p">,</span>
    <span class="s1">&#39;gae&#39;</span><span class="p">:</span> <span class="n">AppEngineServer</span><span class="p">,</span>
    <span class="s1">&#39;twisted&#39;</span><span class="p">:</span> <span class="n">TwistedServer</span><span class="p">,</span>
    <span class="s1">&#39;diesel&#39;</span><span class="p">:</span> <span class="n">DieselServer</span><span class="p">,</span>
    <span class="s1">&#39;meinheld&#39;</span><span class="p">:</span> <span class="n">MeinheldServer</span><span class="p">,</span>
    <span class="s1">&#39;gunicorn&#39;</span><span class="p">:</span> <span class="n">GunicornServer</span><span class="p">,</span>
    <span class="s1">&#39;eventlet&#39;</span><span class="p">:</span> <span class="n">EventletServer</span><span class="p">,</span>
    <span class="s1">&#39;gevent&#39;</span><span class="p">:</span> <span class="n">GeventServer</span><span class="p">,</span>
    <span class="s1">&#39;geventSocketIO&#39;</span><span class="p">:</span><span class="n">GeventSocketIOServer</span><span class="p">,</span>
    <span class="s1">&#39;rocket&#39;</span><span class="p">:</span> <span class="n">RocketServer</span><span class="p">,</span>
    <span class="s1">&#39;bjoern&#39;</span> <span class="p">:</span> <span class="n">BjoernServer</span><span class="p">,</span>
    <span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">AutoServer</span><span class="p">,</span>
<span class="p">}</span>






<span class="c1">###############################################################################</span>
<span class="c1"># Application Control ##########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../api.html#bottle.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">namespace</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 모듈을 임포트 하거나 모듈에서 객체 가져오기.</span>

<span class="sd">        * ``package.module``: `module`\을 모듈 객체로 반환.</span>
<span class="sd">        * ``pack.mod:name``: `pack.mod`\의 모듈 변수 `name` 반환.</span>
<span class="sd">        * ``pack.mod:func()``:`pack.mod.func()` 호출하고 결과 반환.</span>

<span class="sd">        마지막 형식은 함수 호출뿐 아니라 임의 타입의 식도 받는다.</span>
<span class="sd">        이 함수에 전달한 키워드 인자들이 지역 변수로 사용 가능해진다.</span>
<span class="sd">        예: ``import_string(&#39;re:compile(x)&#39;, x=&#39;[a-z]&#39;)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">target</span> <span class="k">else</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span> <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">],</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">namespace</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span> <span class="n">namespace</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_app"><a class="viewcode-back" href="../api.html#bottle.load_app">[docs]</a><span class="k">def</span> <span class="nf">load_app</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 모듈에서 보틀 응용을 적재하면서 임포트가 현재 기본 응용에 영향을</span>
<span class="sd">        주지 않도록 하고, 별도의 응용 객체를 반환한다. target 매개변수에</span>
<span class="sd">        대해선 :func:`load` 참고. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">NORUN</span><span class="p">;</span> <span class="n">NORUN</span><span class="p">,</span> <span class="n">nr_old</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">NORUN</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">default_app</span><span class="o">.</span><span class="n">push</span><span class="p">()</span> <span class="c1"># Create a new &quot;default application&quot;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="c1"># Import the target module</span>
        <span class="k">return</span> <span class="n">rv</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span> <span class="k">else</span> <span class="n">tmp</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">default_app</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="c1"># Remove the temporary added default application</span>
        <span class="n">NORUN</span> <span class="o">=</span> <span class="n">nr_old</span></div>

<span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
<div class="viewcode-block" id="run"><a class="viewcode-back" href="../api.html#bottle.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s1">&#39;wsgiref&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reloader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 서버 인스턴스 시작. 서버가 종료할 때까지 이 메소드는 블록 된다.</span>

<span class="sd">        :param app: WSGI 응용 또는 :func:`load_app`\에서 지원하는</span>
<span class="sd">               대상 문자열. (기본값: :func:`default_app`)</span>
<span class="sd">        :param server: 사용할 서버 어댑터. 유효한 이름은</span>
<span class="sd">               :data:`server_names`\의 키 참고. :class:`ServerAdapter`</span>
<span class="sd">               서브클래스 전달해도 됨. (기본값: `wsgiref`)</span>
<span class="sd">        :param host: 바인드 할 서버 주소. 외부 인터페이스 포함 모든</span>
<span class="sd">               인터페이스에 리슨 하려면 ``0.0.0.0``. (기본값: 127.0.0.1)</span>
<span class="sd">        :param port: 바인드 할 서버 포트. 1024 아래 값에는 루트 권한</span>
<span class="sd">               필요. (기본값: 8080)</span>
<span class="sd">        :param reloader: 자동 재적재 서버 시작? (기본값: False)</span>
<span class="sd">        :param interval: 자동 재적재 확인 간격. 초 단위. (기본값: 1)</span>
<span class="sd">        :param quiet: stdout 및 stderr 출력 끄기? (기본값: False)</span>
<span class="sd">        :param options: 서버 어댑터로 전달할 옵션들.</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NORUN</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">reloader</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BOTTLE_CHILD&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lockfile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">lockfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bottle.&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.lock&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span> <span class="c1"># We only need this file to exist. We never write to it</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
                <span class="n">environ</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;BOTTLE_CHILD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;BOTTLE_LOCKFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lockfile</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environ</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Busy wait...</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># I am alive!</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">_debug</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">app</span> <span class="ow">or</span> <span class="n">default_app</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">load_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Application is not callable: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">app</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">server_names</span><span class="p">:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">server_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">ServerAdapter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown or unsupported server: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">server</span><span class="p">)</span>

        <span class="n">server</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">quiet</span> <span class="ow">or</span> <span class="n">quiet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">server</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Bottle v</span><span class="si">%s</span><span class="s2"> server starting up (using </span><span class="si">%s</span><span class="s2">)...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">server</span><span class="p">)))</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Listening on http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">/</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Hit Ctrl-C to quit.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reloader</span><span class="p">:</span>
            <span class="n">lockfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BOTTLE_LOCKFILE&#39;</span><span class="p">)</span>
            <span class="n">bgcheck</span> <span class="o">=</span> <span class="n">FileCheckerThread</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">bgcheck</span><span class="p">:</span>
                <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bgcheck</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;reload&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
        <span class="k">raise</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reloader</span><span class="p">:</span> <span class="k">raise</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="p">):</span>
            <span class="n">print_exc</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></div>



<span class="k">class</span> <span class="nc">FileCheckerThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Interrupt main-thread as soon as a changed module file is detected,</span>
<span class="sd">        the lockfile gets deleted or gets to old. &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span>
        <span class="c1">#: Is one of &#39;reload&#39;, &#39;error&#39; or &#39;exit&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.pyo&#39;</span><span class="p">,</span> <span class="s1">&#39;.pyc&#39;</span><span class="p">):</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">files</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">)</span>\
            <span class="ow">or</span> <span class="n">mtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">-</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">interrupt_main</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">lmtime</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">mtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lmtime</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;reload&#39;</span>
                    <span class="n">thread</span><span class="o">.</span><span class="n">interrupt_main</span><span class="p">()</span>
                    <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;exit&#39;</span> <span class="c1"># silent exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span>





<span class="c1">###############################################################################</span>
<span class="c1"># Template Adapters ############################################################</span>
<span class="c1">###############################################################################</span>


<span class="k">class</span> <span class="nc">TemplateError</span><span class="p">(</span><span class="n">HTTPError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">HTTPError</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>


<div class="viewcode-block" id="BaseTemplate"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate">[docs]</a><span class="k">class</span> <span class="nc">BaseTemplate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 템플릿 어댑터 기반 클래스이자 최소 API &quot;&quot;&quot;</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tpl&#39;</span><span class="p">,</span><span class="s1">&#39;html&#39;</span><span class="p">,</span><span class="s1">&#39;thtml&#39;</span><span class="p">,</span><span class="s1">&#39;stpl&#39;</span><span class="p">]</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used in prepare()</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used in render()</span>

<div class="viewcode-block" id="BaseTemplate.__init__"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="p">[],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 새 템플릿 만들기.</span>
<span class="sd">        source 매개변수(str 또는 buffer)가 없으면 name 인자를 이용해 템플릿</span>
<span class="sd">        파일 이름을 추측한다. 서브클래스에선 self.source 및/또는 self.filename이</span>
<span class="sd">        설정돼 있다고 상정할 수 있다. 둘 모두 문자열이다.</span>
<span class="sd">        lookup, encoding, settings 매개변수는 인스턴스 변수로 저장된다.</span>
<span class="sd">        lookup 매개변수는 디렉터리 경로들을 담은 리스트다.</span>
<span class="sd">        encoding 매개변수는 바이트열이나 파일을 디코딩 하는 데 쓰게 된다.</span>
<span class="sd">        settings 매개변수는 엔진별 설정들의 딕셔너리다.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">filename</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lookup</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Copy from class variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="c1"># Apply</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span><span class="s1">&#39;Template </span><span class="si">%s</span><span class="s1"> not found.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span><span class="s1">&#39;No template specified.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseTemplate.search"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate.search">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; lookup에 지정된 모든 디렉터리에서 이름을 탐색.</span>
<span class="sd">        일단 확장자 없이, 다음엔 많이 쓰는 확장자들로. 처음 걸린 것 반환. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lookup</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;The template lookup path list should not be empty.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Absolute template path names are deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">spath</span> <span class="ow">in</span> <span class="n">lookup</span><span class="p">:</span>
            <span class="n">spath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> <span class="k">return</span> <span class="n">fname</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseTemplate.global_config"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate.global_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">global_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; class.settings에 저장된 전역 설정을 읽거나 설정한다. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Make settings local to class</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="BaseTemplate.prepare"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 준비 동작(파싱, 캐싱, ...) 수행.</span>
<span class="sd">        템플릿을 갱신하거나 설정을 바꾸기 위해 다시 호출하는 게</span>
<span class="sd">        가능해야 한다.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="BaseTemplate.render"><a class="viewcode-back" href="../api.html#bottle.BaseTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 지정한 지역 변수들로 템플릿을 렌더링 해서 바이트열 또는</span>
<span class="sd">        유니코드열을 하나 반환한다. 바이트열인 경우 인코딩이</span>
<span class="sd">        self.encoding과 일치해야 한다. 이 메소드는 스레드에 안전해야</span>
<span class="sd">        한다. 지역 변수들이 딕셔너리로(args) 제공될 수도 있고 바로</span>
<span class="sd">        키워드로(kwargs) 제공될 수도 있다.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<span class="k">class</span> <span class="nc">MakoTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">mako.template</span> <span class="kn">import</span> <span class="n">Template</span>
        <span class="kn">from</span> <span class="nn">mako.lookup</span> <span class="kn">import</span> <span class="n">TemplateLookup</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;input_encoding&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">})</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;format_exceptions&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">))</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="n">TemplateLookup</span><span class="p">(</span><span class="n">directories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">_defaults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CheetahTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">Cheetah.Template</span> <span class="kn">import</span> <span class="n">Template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;searchList&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>


<span class="k">class</span> <span class="nc">Jinja2Template</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FunctionLoader</span>
        <span class="k">if</span> <span class="s1">&#39;prefix&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="c1"># TODO: to be removed after a while</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The keyword argument `prefix` has been removed. &#39;</span>
                <span class="s1">&#39;Use the full jinja2 environment name line_statement_prefix instead.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FunctionLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">globals</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">globals</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">_defaults</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>


<div class="viewcode-block" id="SimpleTemplate"><a class="viewcode-back" href="../stpl.html#bottle.SimpleTemplate">[docs]</a><span class="k">class</span> <span class="nc">SimpleTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>

<div class="viewcode-block" id="SimpleTemplate.prepare"><a class="viewcode-back" href="../stpl.html#bottle.SimpleTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">escape_func</span><span class="o">=</span><span class="n">html_escape</span><span class="p">,</span> <span class="n">noescape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_str</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">touni</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">escape_func</span><span class="p">(</span><span class="n">touni</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">enc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syntax</span> <span class="o">=</span> <span class="n">syntax</span>
        <span class="k">if</span> <span class="n">noescape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">co</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="s1">&#39;utf8&#39;</span>
        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Template encodings other than utf8 are no longer supported.&#39;</span><span class="p">)</span> <span class="c1">#0.11</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">),</span> <span class="s1">&#39;latin1&#39;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">StplParser</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syntax</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">translate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">encoding</span>
        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span> <span class="nf">_rebase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_env</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Rebase function called without arguments.&#39;</span>
                 <span class="s1">&#39; You were probably looking for {{base}}?&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="n">_env</span><span class="p">[</span><span class="s1">&#39;_rebase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_env</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Rebase function called without arguments.&#39;</span>
                 <span class="s1">&#39; You were probably looking for {{base}}?&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#0.12</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">_env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">_name</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_stdout&#39;</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_stdout</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;_stdout&#39;</span><span class="p">:</span> <span class="n">_stdout</span><span class="p">,</span> <span class="s1">&#39;_printlist&#39;</span><span class="p">:</span> <span class="n">_stdout</span><span class="o">.</span><span class="n">extend</span><span class="p">,</span>
            <span class="s1">&#39;include&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
            <span class="s1">&#39;rebase&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rebase</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="s1">&#39;_rebase&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;_str&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">,</span> <span class="s1">&#39;_escape&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
            <span class="s1">&#39;setdefault&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">setdefault</span><span class="p">,</span> <span class="s1">&#39;defined&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="fm">__contains__</span> <span class="p">})</span>
        <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">co</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_rebase&#39;</span><span class="p">):</span>
            <span class="n">subtpl</span><span class="p">,</span> <span class="n">rargs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_rebase&#39;</span><span class="p">)</span>
            <span class="n">rargs</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_stdout</span><span class="p">)</span> <span class="c1">#copy stdout</span>
            <span class="k">del</span> <span class="n">_stdout</span><span class="p">[:]</span> <span class="c1"># clear stdout</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">subtpl</span><span class="p">,</span> <span class="o">**</span><span class="n">rargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>

<div class="viewcode-block" id="SimpleTemplate.render"><a class="viewcode-back" href="../stpl.html#bottle.SimpleTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 키워드 인자들을 지역 변수로 해서 템플릿을 렌더링 한다. &quot;&quot;&quot;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">stdout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">StplSyntaxError</span><span class="p">(</span><span class="n">TemplateError</span><span class="p">):</span> <span class="k">pass</span>


<span class="k">class</span> <span class="nc">StplParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Parser for stpl templates. &#39;&#39;&#39;</span>
    <span class="n">_re_cache</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#: Cache for compiled re patterns</span>
    <span class="c1"># This huge pile of voodoo magic splits python code into 8 different tokens.</span>
    <span class="c1"># 1: All kinds of python strings (trust me, it works)</span>
    <span class="n">_re_tok</span> <span class="o">=</span> <span class="s1">&#39;([urbURB]?(?:</span><span class="se">\&#39;\&#39;</span><span class="s1">(?!</span><span class="se">\&#39;</span><span class="s1">)|&quot;&quot;(?!&quot;)|</span><span class="se">\&#39;</span><span class="si">{6}</span><span class="s1">|&quot;</span><span class="si">{6}</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;|</span><span class="se">\&#39;</span><span class="s1">(?:[^</span><span class="se">\\\\\&#39;</span><span class="s1">]|</span><span class="se">\\\\</span><span class="s1">.)+?</span><span class="se">\&#39;</span><span class="s1">|&quot;(?:[^</span><span class="se">\\\\</span><span class="s1">&quot;]|</span><span class="se">\\\\</span><span class="s1">.)+?&quot;&#39;</span> \
               <span class="s1">&#39;|</span><span class="se">\&#39;</span><span class="si">{3}</span><span class="s1">(?:[^</span><span class="se">\\\\</span><span class="s1">]|</span><span class="se">\\\\</span><span class="s1">.|</span><span class="se">\\</span><span class="s1">n)+?</span><span class="se">\&#39;</span><span class="si">{3}</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;|&quot;</span><span class="si">{3}</span><span class="s1">(?:[^</span><span class="se">\\\\</span><span class="s1">]|</span><span class="se">\\\\</span><span class="s1">.|</span><span class="se">\\</span><span class="s1">n)+?&quot;</span><span class="si">{3}</span><span class="s1">))&#39;</span>
    <span class="n">_re_inl</span> <span class="o">=</span> <span class="n">_re_tok</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># We re-use this string pattern later</span>
    <span class="c1"># 2: Comments (until end of line, but not the newline itself)</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|(#.*)&#39;</span>
    <span class="c1"># 3,4: Open and close grouping tokens</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|([</span><span class="se">\\</span><span class="s1">[</span><span class="se">\\</span><span class="s1">{</span><span class="se">\\</span><span class="s1">(])&#39;</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|([</span><span class="se">\\</span><span class="s1">]</span><span class="se">\\</span><span class="s1">}</span><span class="se">\\</span><span class="s1">)])&#39;</span>
    <span class="c1"># 5,6: Keywords that start or continue a python block (only start of line)</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|^([ </span><span class="se">\\</span><span class="s1">t]*(?:if|for|while|with|try|def|class)</span><span class="se">\\</span><span class="s1">b)&#39;</span> \
               <span class="s1">&#39;|^([ </span><span class="se">\\</span><span class="s1">t]*(?:elif|else|except|finally)</span><span class="se">\\</span><span class="s1">b)&#39;</span>
    <span class="c1"># 7: Our special &#39;end&#39; keyword (but only if it stands alone)</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|((?:^|;)[ </span><span class="se">\\</span><span class="s1">t]*end[ </span><span class="se">\\</span><span class="s1">t]*(?=(?:</span><span class="si">%(block_close)s</span><span class="s1">[ </span><span class="se">\\</span><span class="s1">t]*)?</span><span class="se">\\</span><span class="s1">r?$|;|#))&#39;</span>
    <span class="c1"># 8: A customizable end-of-code-block template token (only end of line)</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|(</span><span class="si">%(block_close)s</span><span class="s1">[ </span><span class="se">\\</span><span class="s1">t]*(?=</span><span class="se">\\</span><span class="s1">r?$))&#39;</span>
    <span class="c1"># 9: And finally, a single newline. The 10th token is &#39;everything else&#39;</span>
    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="s1">&#39;|(</span><span class="se">\\</span><span class="s1">r?</span><span class="se">\\</span><span class="s1">n)&#39;</span>

    <span class="c1"># Match the start tokens of code areas in a template</span>
    <span class="n">_re_split</span> <span class="o">=</span> <span class="s1">&#39;(?m)^[ </span><span class="se">\t</span><span class="s1">]*(</span><span class="se">\\\\</span><span class="s1">?)((</span><span class="si">%(line_start)s</span><span class="s1">)|(</span><span class="si">%(block_start)s</span><span class="s1">))(</span><span class="si">%%</span><span class="s1">?)&#39;</span>
    <span class="c1"># Match inline statements (may contain python strings)</span>
    <span class="n">_re_inl</span> <span class="o">=</span> <span class="s1">&#39;(?m)</span><span class="si">%%</span><span class="s1">(inline_start)s((?:</span><span class="si">%s</span><span class="s1">|[^</span><span class="se">\&#39;</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">]*?)+)</span><span class="si">%%</span><span class="s1">(inline_end)s&#39;</span> <span class="o">%</span> <span class="n">_re_inl</span>
    <span class="n">_re_tok</span> <span class="o">=</span> <span class="s1">&#39;(?m)&#39;</span> <span class="o">+</span> <span class="n">_re_tok</span>

    <span class="n">default_syntax</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">% %</span><span class="s1">&gt; % {{ }}&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="p">),</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_syntax</span><span class="p">(</span><span class="n">syntax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_syntax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Tokens as a space separated string (default: &lt;% %&gt; % {{ }}) &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span>

    <span class="k">def</span> <span class="nf">set_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syntax</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span> <span class="o">=</span> <span class="n">syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="n">syntax</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">syntax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="s1">&#39;block_start block_close line_start inline_start inline_end&#39;</span>
            <span class="n">etokens</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">)</span>
            <span class="n">pattern_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">etokens</span><span class="p">))</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_re_split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_inl</span><span class="p">)</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">p</span><span class="o">%</span><span class="n">pattern_vars</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">[</span><span class="n">syntax</span><span class="p">]</span> <span class="o">=</span> <span class="n">patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re_split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_inl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">[</span><span class="n">syntax</span><span class="p">]</span>

    <span class="n">syntax</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_syntax</span><span class="p">,</span> <span class="n">set_syntax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Parser is a one time instance.&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_split</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># New escape syntax</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:]</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="n">line</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Old escape syntax</span>
                    <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;Escape code lines with a backslash.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:]</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">line</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flush_text</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_code</span><span class="p">(</span><span class="n">multiline</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush_text</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiline</span><span class="p">):</span>
        <span class="n">code_line</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_tok</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code_line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">comment</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">code_line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">_str</span><span class="p">,</span> <span class="n">_com</span><span class="p">,</span> <span class="n">_po</span><span class="p">,</span> <span class="n">_pc</span><span class="p">,</span> <span class="n">_blk1</span><span class="p">,</span> <span class="n">_blk2</span><span class="p">,</span> <span class="n">_end</span><span class="p">,</span> <span class="n">_cend</span><span class="p">,</span> <span class="n">_nl</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">code_line</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_blk1</span> <span class="ow">or</span> <span class="n">_blk2</span><span class="p">):</span> <span class="c1"># a if b else c</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_blk1</span> <span class="ow">or</span> <span class="n">_blk2</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">_str</span><span class="p">:</span>    <span class="c1"># Python string</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_str</span>
            <span class="k">elif</span> <span class="n">_com</span><span class="p">:</span>  <span class="c1"># Python comment (up to EOL)</span>
                <span class="n">comment</span> <span class="o">=</span> <span class="n">_com</span>
                <span class="k">if</span> <span class="n">multiline</span> <span class="ow">and</span> <span class="n">_com</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Allow end-of-block in comments</span>
            <span class="k">elif</span> <span class="n">_po</span><span class="p">:</span>  <span class="c1"># open parenthesis</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_po</span>
            <span class="k">elif</span> <span class="n">_pc</span><span class="p">:</span>  <span class="c1"># close parenthesis</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we could check for matching parentheses here, but it&#39;s</span>
                    <span class="c1"># easier to leave that to python - just check counts</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_pc</span>
            <span class="k">elif</span> <span class="n">_blk1</span><span class="p">:</span> <span class="c1"># Start-block keyword (if/for/while/def/try/...)</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="n">_blk1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_blk2</span><span class="p">:</span> <span class="c1"># Continue-block keyword (else/elif/except/...)</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="n">_blk2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_end</span><span class="p">:</span>  <span class="c1"># The non-standard &#39;end&#39;-keyword (ends a block)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_cend</span><span class="p">:</span> <span class="c1"># The end-code-block template token (usually &#39;%&gt;&#39;)</span>
                <span class="k">if</span> <span class="n">multiline</span><span class="p">:</span> <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_cend</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># \n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code_line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">comment</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">multiline</span><span class="p">:</span>
                    <span class="k">break</span>

    <span class="k">def</span> <span class="nf">flush_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">parts</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nl</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;  &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_inl</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()],</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">prefix</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">))))</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nl</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_inline</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\\r\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">lines</span><span class="p">)))</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;_printlist((</span><span class="si">%s</span><span class="s1">,))&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="n">code</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;_str(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="s1">&#39;_escape(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">chunk</span>

    <span class="k">def</span> <span class="nf">write_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_backward_compatibility</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
        <span class="n">code</span>  <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">comment</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fix_backward_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="s1">&#39;rebase&#39;</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;The include and rebase keywords are functions now.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   <span class="k">return</span> <span class="s2">&quot;_printlist([base])&quot;</span><span class="p">,</span> <span class="n">comment</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;_=</span><span class="si">%s</span><span class="s2">(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="n">comment</span>
            <span class="k">else</span><span class="p">:</span>                 <span class="k">return</span> <span class="s2">&quot;_=</span><span class="si">%s</span><span class="s2">(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="n">comment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;coding&#39;</span> <span class="ow">in</span> <span class="n">comment</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#.*coding[:=]\s*([-\w.]+)&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">depr</span><span class="p">(</span><span class="s1">&#39;PEP263 encoding strings in templates are deprecated.&#39;</span><span class="p">)</span> <span class="c1">#0.12</span>
                <span class="n">enc</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">enc</span>
                <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;coding&#39;</span><span class="p">,</span><span class="s1">&#39;coding*&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">comment</span>


<div class="viewcode-block" id="template"><a class="viewcode-back" href="../api.html#bottle.template">[docs]</a><span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    렌더링 된 템플릿을 문자열 이터레이터로 얻기.</span>
<span class="sd">    첫 번째 매개변수에 이름, 파일 이름, 템플릿 문자열을 쓸 수 있다.</span>
<span class="sd">    템플릿 렌더링 인자를 딕셔너리로 또는 (키워드 인자로) 직접</span>
<span class="sd">    줄 수 있다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tpl</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_adapter&#39;</span><span class="p">,</span> <span class="n">SimpleTemplate</span><span class="p">)</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_lookup&#39;</span><span class="p">,</span> <span class="n">TEMPLATE_PATH</span><span class="p">)</span>
    <span class="n">tplid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lookup</span><span class="p">),</span> <span class="n">tpl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tplid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TEMPLATES</span> <span class="ow">or</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_settings&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tpl</span><span class="p">,</span> <span class="n">adapter</span><span class="p">):</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpl</span>
            <span class="k">if</span> <span class="n">settings</span><span class="p">:</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s2">&quot;{&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">tpl</span><span class="p">:</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">tpl</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tpl</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;Template (</span><span class="si">%s</span><span class="s1">) not found&#39;</span> <span class="o">%</span> <span class="n">tpl</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="n">mako_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">MakoTemplate</span><span class="p">)</span>
<span class="n">cheetah_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">CheetahTemplate</span><span class="p">)</span>
<span class="n">jinja2_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">Jinja2Template</span><span class="p">)</span>


<div class="viewcode-block" id="view"><a class="viewcode-back" href="../api.html#bottle.view">[docs]</a><span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">defaults</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; 데코레이터: 핸들러 대신 템플릿을 렌더링.</span>
<span class="sd">        핸들러에서 다음처럼 동작을 제어할 수 있다.</span>

<span class="sd">          - 템플릿 변수들의 dict를 반환하면 그걸로 템플릿을 채운다.</span>
<span class="sd">          - dict 아닌 뭔가를 반환하면 view 데코레이터가 템플릿을 처리하지</span>
<span class="sd">            않고 핸들러 결과를 그대로 반환한다. 예를 들어</span>
<span class="sd">            HTTPResponse(dict)를 반환해서 autojson이나 기타 castfilter로</span>
<span class="sd">            JSON을 얻을 수 있다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">DictMixin</span><span class="p">)):</span>
                <span class="n">tplvars</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">tplvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">tplvars</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span></div>

<span class="n">mako_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">MakoTemplate</span><span class="p">)</span>
<span class="n">cheetah_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">CheetahTemplate</span><span class="p">)</span>
<span class="n">jinja2_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">Jinja2Template</span><span class="p">)</span>






<span class="c1">###############################################################################</span>
<span class="c1"># Constants and Globals ########################################################</span>
<span class="c1">###############################################################################</span>


<span class="n">TEMPLATE_PATH</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;./views/&#39;</span><span class="p">]</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">NORUN</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># If set, run() does nothing. Used by load_app()</span>

<span class="c1">#: HTTP 상태 코드(예: 404)를 문구(예: &#39;Not Found&#39;)로 매핑 하는 dict</span>
<span class="n">HTTP_CODES</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">responses</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">418</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span> <span class="c1"># RFC 2324</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">422</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unprocessable Entity&quot;</span> <span class="c1"># RFC 4918</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">428</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Precondition Required&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">429</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Too Many Requests&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">431</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Request Header Fields Too Large&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">511</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Network Authentication Required&quot;</span>
<span class="n">_HTTP_STATUS_LINES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">HTTP_CODES</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="c1">#: The default template used for error pages. Override with @error()</span>
<span class="n">ERROR_PAGE_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="si">%%</span><span class="s2">try:</span>
<span class="s2">    </span><span class="si">%%</span><span class="s2">from </span><span class="si">%s</span><span class="s2"> import DEBUG, HTTP_CODES, request, touni</span>
<span class="s2">    &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">        &lt;head&gt;</span>
<span class="s2">            &lt;title&gt;Error: {{e.status}}&lt;/title&gt;</span>
<span class="s2">            &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s2">              html {background-color: #eee; font-family: sans;}</span>
<span class="s2">              body {background-color: #fff; border: 1px solid #ddd;</span>
<span class="s2">                    padding: 15px; margin: 15px;}</span>
<span class="s2">              pre {background-color: #eee; border: 1px solid #ddd; padding: 5px;}</span>
<span class="s2">            &lt;/style&gt;</span>
<span class="s2">        &lt;/head&gt;</span>
<span class="s2">        &lt;body&gt;</span>
<span class="s2">            &lt;h1&gt;Error: {{e.status}}&lt;/h1&gt;</span>
<span class="s2">            &lt;p&gt;Sorry, the requested URL &lt;tt&gt;{{repr(request.url)}}&lt;/tt&gt;</span>
<span class="s2">               caused an error:&lt;/p&gt;</span>
<span class="s2">            &lt;pre&gt;{{e.body}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">if DEBUG and e.exception:</span>
<span class="s2">              &lt;h2&gt;Exception:&lt;/h2&gt;</span>
<span class="s2">              &lt;pre&gt;{{repr(e.exception)}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">end</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">if DEBUG and e.traceback:</span>
<span class="s2">              &lt;h2&gt;Traceback:&lt;/h2&gt;</span>
<span class="s2">              &lt;pre&gt;{{e.traceback}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">end</span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="si">%%</span><span class="s2">except ImportError:</span>
<span class="s2">    &lt;b&gt;ImportError:&lt;/b&gt; Could not generate the error page. Please add bottle to</span>
<span class="s2">    the import path.</span>
<span class="si">%%</span><span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="vm">__name__</span>

<span class="c1">#: 스레드에 안전한 :class:`LocalRequest` 인스턴스. 요청 콜백 내에서</span>
<span class="c1">#: 접근 시 이 인스턴스는 (다중 스레드 서버에서도) 항상 *현재* 요청을</span>
<span class="c1">#: 가리킨다.</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">LocalRequest</span><span class="p">()</span>

<span class="c1">#: 스레드에 안전한 :class:`LocalResponse` 인스턴스. *현재* 요청에 대한</span>
<span class="c1">#: HTTP 응답을 바꾸는 데 쓴다.</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">LocalResponse</span><span class="p">()</span>

<span class="c1">#: A thread-safe namespace. Not used by Bottle.</span>
<span class="n">local</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

<span class="c1"># Initialize app stack (create first empty Bottle app)</span>
<span class="c1"># BC: 0.6.4 and needed for run()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">default_app</span> <span class="o">=</span> <span class="n">AppStack</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>

<span class="c1">#: A virtual package that redirects import statements.</span>
<span class="c1">#: Example: ``import bottle.ext.sqlite`` actually imports `bottle_sqlite`.</span>
<span class="n">ext</span> <span class="o">=</span> <span class="n">_ImportRedirect</span><span class="p">(</span><span class="s1">&#39;bottle.ext&#39;</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="k">else</span> <span class="vm">__name__</span><span class="o">+</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span> <span class="s1">&#39;bottle_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">module</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">opt</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">_cmd_options</span><span class="p">,</span> <span class="n">_cmd_args</span><span class="p">,</span> <span class="n">_cmd_parser</span>
    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="n">_stdout</span><span class="p">(</span><span class="s1">&#39;Bottle </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">__version__</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">_stderr</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error: No application specified.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bottle&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">])</span>

    <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">bind</span> <span class="ow">or</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span> <span class="mi">8080</span>
    <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">host</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">host</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span>

    <span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="n">server</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
        <span class="n">reloader</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">reload</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">plugin</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>




<span class="c1"># THE END</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Bottle</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">따라하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">설정 (작업 중)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">요청 라우팅</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stpl.html">SimpleTemplate 엔진</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API 참조</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">사용 가능한 플러그인 목록</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_app.html">따라하기: 할일 목록 응용</a></li>
<li class="toctree-l1"><a class="reference internal" href="../async.html">비동기 응용 입문</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipes.html">간단 해법</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">자주 묻는 질문</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">릴리스 노트와 변경 로그</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html#id2">기여자</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">개발자를 위해</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugindev.html">플러그인 개발 안내서</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">사용 가능한 플러그인 목록</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009-2020, Marcel Hellkamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>